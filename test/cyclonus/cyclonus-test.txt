time="2021-04-29T00:14:19Z" level=info msg="log level set to 'info'"
args: 
{
  "AllowDNS": true,
  "Noisy": true,
  "IgnoreLoopback": true,
  "PerturbationWaitSeconds": 5,
  "PodCreationTimeoutSeconds": 20,
  "Retries": 1,
  "BatchJobs": false,
  "Context": "",
  "ServerPorts": [
    80,
    81
  ],
  "ServerProtocols": [
    "TCP",
    "UDP",
    "SCTP"
  ],
  "ServerNamespaces": [
    "x",
    "y",
    "z"
  ],
  "ServerPods": [
    "a",
    "b",
    "c"
  ],
  "CleanupNamespaces": true,
  "Include": [],
  "Exclude": [
    "multi-peer",
    "upstream-e2e",
    "example",
    "end-port"
  ],
  "DestinationType": "",
  "Mock": false,
  "DryRun": false,
  "JobTimeoutSeconds": 10
}
Cyclonus version: 
{
  "BuildTime": "2021-04-25T14:32:31Z",
  "GitSHA": "e0b5119e045a28d0fa78318b7b8a8901504a7e00",
  "Version": "0.4.4"
}
Kubernetes server version: 
{
  "major": "1",
  "minor": "19",
  "gitVersion": "v1.19.1",
  "gitCommit": "206bcadf021e76c27513500ca24182692aabd17e",
  "gitTreeState": "clean",
  "buildDate": "2020-09-14T07:30:52Z",
  "goVersion": "go1.15",
  "compiler": "gc",
  "platform": "linux/amd64"
}
time="2021-04-29T00:14:26Z" level=info msg="waiting for 9 pods to be running and have IP addresses; currently 0 are ready"
time="2021-04-29T00:14:31Z" level=info msg="waiting for 9 pods to be running and have IP addresses; currently 0 are ready"
time="2021-04-29T00:14:36Z" level=info msg="waiting for 9 pods to be running and have IP addresses; currently 3 are ready"
resources:
+-----------+-----------+-----+------------+------------------------+--------------------------------+
| NAMESPACE | NS LABELS | POD | POD LABELS |          IPS           |        CONTAINERS/PORTS        |
+-----------+-----------+-----+------------+------------------------+--------------------------------+
| x         | ns: x     | a   | pod: a     | pod: 10.10.1.3         | cont-80-tcp, port              |
|           |           |     |            | service: 10.11.41.140  | serve-80-tcp: 80 on TCP        |
+           +           +     +            +                        +--------------------------------+
|           |           |     |            |                        | cont-80-udp, port              |
|           |           |     |            |                        | serve-80-udp: 80 on UDP        |
+           +           +     +            +                        +--------------------------------+
|           |           |     |            |                        | cont-80-sctp, port             |
|           |           |     |            |                        | serve-80-sctp: 80 on SCTP      |
+           +           +     +            +                        +--------------------------------+
|           |           |     |            |                        | cont-81-tcp, port              |
|           |           |     |            |                        | serve-81-tcp: 81 on TCP        |
+           +           +     +            +                        +--------------------------------+
|           |           |     |            |                        | cont-81-udp, port              |
|           |           |     |            |                        | serve-81-udp: 81 on UDP        |
+           +           +     +            +                        +--------------------------------+
|           |           |     |            |                        | cont-81-sctp, port             |
|           |           |     |            |                        | serve-81-sctp: 81 on SCTP      |
+           +           +-----+------------+------------------------+--------------------------------+
|           |           | b   | pod: b     | pod: 10.10.2.4         | cont-80-tcp, port              |
|           |           |     |            | service: 10.11.236.141 | serve-80-tcp: 80 on TCP        |
+           +           +     +            +                        +--------------------------------+
|           |           |     |            |                        | cont-80-udp, port              |
|           |           |     |            |                        | serve-80-udp: 80 on UDP        |
+           +           +     +            +                        +--------------------------------+
|           |           |     |            |                        | cont-80-sctp, port             |
|           |           |     |            |                        | serve-80-sctp: 80 on SCTP      |
+           +           +     +            +                        +--------------------------------+
|           |           |     |            |                        | cont-81-tcp, port              |
|           |           |     |            |                        | serve-81-tcp: 81 on TCP        |
+           +           +     +            +                        +--------------------------------+
|           |           |     |            |                        | cont-81-udp, port              |
|           |           |     |            |                        | serve-81-udp: 81 on UDP        |
+           +           +     +            +                        +--------------------------------+
|           |           |     |            |                        | cont-81-sctp, port             |
|           |           |     |            |                        | serve-81-sctp: 81 on SCTP      |
+           +           +-----+------------+------------------------+--------------------------------+
|           |           | c   | pod: c     | pod: 10.10.1.4         | cont-80-tcp, port              |
|           |           |     |            | service: 10.11.76.116  | serve-80-tcp: 80 on TCP        |
+           +           +     +            +                        +--------------------------------+
|           |           |     |            |                        | cont-80-udp, port              |
|           |           |     |            |                        | serve-80-udp: 80 on UDP        |
+           +           +     +            +                        +--------------------------------+
|           |           |     |            |                        | cont-80-sctp, port             |
|           |           |     |            |                        | serve-80-sctp: 80 on SCTP      |
+           +           +     +            +                        +--------------------------------+
|           |           |     |            |                        | cont-81-tcp, port              |
|           |           |     |            |                        | serve-81-tcp: 81 on TCP        |
+           +           +     +            +                        +--------------------------------+
|           |           |     |            |                        | cont-81-udp, port              |
|           |           |     |            |                        | serve-81-udp: 81 on UDP        |
+           +           +     +            +                        +--------------------------------+
|           |           |     |            |                        | cont-81-sctp, port             |
|           |           |     |            |                        | serve-81-sctp: 81 on SCTP      |
+-----------+-----------+-----+------------+------------------------+--------------------------------+
| y         | ns: y     | a   | pod: a     | pod: 10.10.2.5         | cont-80-tcp, port              |
|           |           |     |            | service: 10.11.115.162 | serve-80-tcp: 80 on TCP        |
+           +           +     +            +                        +--------------------------------+
|           |           |     |            |                        | cont-80-udp, port              |
|           |           |     |            |                        | serve-80-udp: 80 on UDP        |
+           +           +     +            +                        +--------------------------------+
|           |           |     |            |                        | cont-80-sctp, port             |
|           |           |     |            |                        | serve-80-sctp: 80 on SCTP      |
+           +           +     +            +                        +--------------------------------+
|           |           |     |            |                        | cont-81-tcp, port              |
|           |           |     |            |                        | serve-81-tcp: 81 on TCP        |
+           +           +     +            +                        +--------------------------------+
|           |           |     |            |                        | cont-81-udp, port              |
|           |           |     |            |                        | serve-81-udp: 81 on UDP        |
+           +           +     +            +                        +--------------------------------+
|           |           |     |            |                        | cont-81-sctp, port             |
|           |           |     |            |                        | serve-81-sctp: 81 on SCTP      |
+           +           +-----+------------+------------------------+--------------------------------+
|           |           | b   | pod: b     | pod: 10.10.1.5         | cont-80-tcp, port              |
|           |           |     |            | service: 10.11.236.165 | serve-80-tcp: 80 on TCP        |
+           +           +     +            +                        +--------------------------------+
|           |           |     |            |                        | cont-80-udp, port              |
|           |           |     |            |                        | serve-80-udp: 80 on UDP        |
+           +           +     +            +                        +--------------------------------+
|           |           |     |            |                        | cont-80-sctp, port             |
|           |           |     |            |                        | serve-80-sctp: 80 on SCTP      |
+           +           +     +            +                        +--------------------------------+
|           |           |     |            |                        | cont-81-tcp, port              |
|           |           |     |            |                        | serve-81-tcp: 81 on TCP        |
+           +           +     +            +                        +--------------------------------+
|           |           |     |            |                        | cont-81-udp, port              |
|           |           |     |            |                        | serve-81-udp: 81 on UDP        |
+           +           +     +            +                        +--------------------------------+
|           |           |     |            |                        | cont-81-sctp, port             |
|           |           |     |            |                        | serve-81-sctp: 81 on SCTP      |
+           +           +-----+------------+------------------------+--------------------------------+
|           |           | c   | pod: c     | pod: 10.10.2.6         | cont-80-tcp, port              |
|           |           |     |            | service: 10.11.245.86  | serve-80-tcp: 80 on TCP        |
+           +           +     +            +                        +--------------------------------+
|           |           |     |            |                        | cont-80-udp, port              |
|           |           |     |            |                        | serve-80-udp: 80 on UDP        |
+           +           +     +            +                        +--------------------------------+
|           |           |     |            |                        | cont-80-sctp, port             |
|           |           |     |            |                        | serve-80-sctp: 80 on SCTP      |
+           +           +     +            +                        +--------------------------------+
|           |           |     |            |                        | cont-81-tcp, port              |
|           |           |     |            |                        | serve-81-tcp: 81 on TCP        |
+           +           +     +            +                        +--------------------------------+
|           |           |     |            |                        | cont-81-udp, port              |
|           |           |     |            |                        | serve-81-udp: 81 on UDP        |
+           +           +     +            +                        +--------------------------------+
|           |           |     |            |                        | cont-81-sctp, port             |
|           |           |     |            |                        | serve-81-sctp: 81 on SCTP      |
+-----------+-----------+-----+------------+------------------------+--------------------------------+
| z         | ns: z     | a   | pod: a     | pod: 10.10.1.6         | cont-80-tcp, port              |
|           |           |     |            | service: 10.11.212.225 | serve-80-tcp: 80 on TCP        |
+           +           +     +            +                        +--------------------------------+
|           |           |     |            |                        | cont-80-udp, port              |
|           |           |     |            |                        | serve-80-udp: 80 on UDP        |
+           +           +     +            +                        +--------------------------------+
|           |           |     |            |                        | cont-80-sctp, port             |
|           |           |     |            |                        | serve-80-sctp: 80 on SCTP      |
+           +           +     +            +                        +--------------------------------+
|           |           |     |            |                        | cont-81-tcp, port              |
|           |           |     |            |                        | serve-81-tcp: 81 on TCP        |
+           +           +     +            +                        +--------------------------------+
|           |           |     |            |                        | cont-81-udp, port              |
|           |           |     |            |                        | serve-81-udp: 81 on UDP        |
+           +           +     +            +                        +--------------------------------+
|           |           |     |            |                        | cont-81-sctp, port             |
|           |           |     |            |                        | serve-81-sctp: 81 on SCTP      |
+           +           +-----+------------+------------------------+--------------------------------+
|           |           | b   | pod: b     | pod: 10.10.2.7         | cont-80-tcp, port              |
|           |           |     |            | service: 10.11.48.14   | serve-80-tcp: 80 on TCP        |
+           +           +     +            +                        +--------------------------------+
|           |           |     |            |                        | cont-80-udp, port              |
|           |           |     |            |                        | serve-80-udp: 80 on UDP        |
+           +           +     +            +                        +--------------------------------+
|           |           |     |            |                        | cont-80-sctp, port             |
|           |           |     |            |                        | serve-80-sctp: 80 on SCTP      |
+           +           +     +            +                        +--------------------------------+
|           |           |     |            |                        | cont-81-tcp, port              |
|           |           |     |            |                        | serve-81-tcp: 81 on TCP        |
+           +           +     +            +                        +--------------------------------+
|           |           |     |            |                        | cont-81-udp, port              |
|           |           |     |            |                        | serve-81-udp: 81 on UDP        |
+           +           +     +            +                        +--------------------------------+
|           |           |     |            |                        | cont-81-sctp, port             |
|           |           |     |            |                        | serve-81-sctp: 81 on SCTP      |
+           +           +-----+------------+------------------------+--------------------------------+
|           |           | c   | pod: c     | pod: 10.10.1.7         | cont-80-tcp, port              |
|           |           |     |            | service: 10.11.155.248 | serve-80-tcp: 80 on TCP        |
+           +           +     +            +                        +--------------------------------+
|           |           |     |            |                        | cont-80-udp, port              |
|           |           |     |            |                        | serve-80-udp: 80 on UDP        |
+           +           +     +            +                        +--------------------------------+
|           |           |     |            |                        | cont-80-sctp, port             |
|           |           |     |            |                        | serve-80-sctp: 80 on SCTP      |
+           +           +     +            +                        +--------------------------------+
|           |           |     |            |                        | cont-81-tcp, port              |
|           |           |     |            |                        | serve-81-tcp: 81 on TCP        |
+           +           +     +            +                        +--------------------------------+
|           |           |     |            |                        | cont-81-udp, port              |
|           |           |     |            |                        | serve-81-udp: 81 on UDP        |
+           +           +     +            +                        +--------------------------------+
|           |           |     |            |                        | cont-81-sctp, port             |
|           |           |     |            |                        | serve-81-sctp: 81 on SCTP      |
+-----------+-----------+-----+------------+------------------------+--------------------------------+

test cases to run by tag:
- ip-block-with-except: 2
- target: 6
- delete-pod: 1
- sctp: 10
- tcp: 16
- peer-ipblock: 4
- numbered-port: 28
- deny-all: 10
- port: 56
- target-pod-selector: 3
- peer-pods: 20
- set-namespace-labels: 1
- end-port: 0
- policy-stack: 0
- named-port: 24
- udp: 16
- example: 0
- any-peer: 2
- create-namespace: 1
- update-policy: 1
- multi-port/protocol: 14
- multi-peer: 0
- all-pods: 14
- conflict: 16
- ingress: 51
- all-namespaces: 10
- namespaces-by-label: 6
- miscellaneous: 22
- upstream-e2e: 0
- target-namespace: 3
- create-policy: 2
- protocol: 42
- pods-by-label: 6
- egress: 51
- delete-namespace: 1
- any-port: 14
- ip-block-no-except: 2
- any-port-protocol: 2
- direction: 100
- action: 6
- delete-policy: 1
- create-pod: 1
- policy-namespace: 4
- set-pod-labels: 1
- allow-all: 6
- rule: 30
- pathological: 6
testing 112 cases

test #1: set namespace to x
 - tags: target, target-namespace
test #2: set namespace to y
 - tags: target, target-namespace
test #3: set namespace to z
 - tags: target, target-namespace
test #4: set pod selector to ["MatchLabels",null,"MatchExpression",null]
 - tags: target, target-pod-selector
test #5: set pod selector to ["MatchLabels",["pod: a"],"MatchExpression",null]
 - tags: target, target-pod-selector
test #6: set pod selector to ["MatchLabels",null,"MatchExpression",[{"key":"pod","operator":"In","values":["a","b"]}]]
 - tags: target, target-pod-selector
test #7: egress: deny all
 - tags: deny-all, direction, egress, rule
test #8: egress: allow all
 - tags: allow-all, direction, egress, rule
test #9: ingress: deny all
 - tags: deny-all, direction, ingress, rule
test #10: ingress: allow all
 - tags: allow-all, direction, ingress, rule
test #11: ingress: empty peers
 - tags: any-peer, direction, ingress, rule
test #12: egress: empty peers
 - tags: any-peer, direction, egress, rule
test #13: empty pods + nil ns
 - tags: all-pods, direction, ingress, peer-pods, policy-namespace
test #14: pods by label + nil ns
 - tags: direction, ingress, peer-pods, pods-by-label, policy-namespace
test #15: nil pods + empty ns
 - tags: all-namespaces, all-pods, direction, ingress, peer-pods
test #16: empty pods + empty ns
 - tags: all-namespaces, all-pods, direction, ingress, peer-pods
test #17: pods by label + empty ns
 - tags: all-namespaces, direction, ingress, peer-pods, pods-by-label
test #18: nil pods + ns by label
 - tags: all-pods, direction, ingress, namespaces-by-label, peer-pods
test #19: empty pods + ns by label
 - tags: all-pods, direction, ingress, namespaces-by-label, peer-pods
test #20: pods by label + ns by label
 - tags: direction, ingress, namespaces-by-label, peer-pods, pods-by-label
test #21: simple ipblock
 - tags: direction, ingress, ip-block-no-except, peer-ipblock
test #22: ipblock with except
 - tags: direction, ingress, ip-block-with-except, peer-ipblock
test #23: empty pods + nil ns
 - tags: all-pods, direction, egress, peer-pods, policy-namespace
test #24: pods by label + nil ns
 - tags: direction, egress, peer-pods, pods-by-label, policy-namespace
test #25: nil pods + empty ns
 - tags: all-namespaces, all-pods, direction, egress, peer-pods
test #26: empty pods + empty ns
 - tags: all-namespaces, all-pods, direction, egress, peer-pods
test #27: pods by label + empty ns
 - tags: all-namespaces, direction, egress, peer-pods, pods-by-label
test #28: nil pods + ns by label
 - tags: all-pods, direction, egress, namespaces-by-label, peer-pods
test #29: empty pods + ns by label
 - tags: all-pods, direction, egress, namespaces-by-label, peer-pods
test #30: pods by label + ns by label
 - tags: direction, egress, namespaces-by-label, peer-pods, pods-by-label
test #31: simple ipblock
 - tags: direction, egress, ip-block-no-except, peer-ipblock
test #32: ipblock with except
 - tags: direction, egress, ip-block-with-except, peer-ipblock
test #33: egress: empty port/protocol
 - tags: any-port-protocol, direction, egress, rule
test #34: ingress: empty port/protocol
 - tags: any-port-protocol, direction, ingress, rule
test #35: any-port,direction,egress,port
 - tags: any-port, direction, egress, port
test #36: direction,egress,numbered-port,port
 - tags: direction, egress, numbered-port, port
test #37: direction,egress,numbered-port,port
 - tags: direction, egress, numbered-port, port
test #38: any-port,direction,egress,port,protocol,tcp
 - tags: any-port, direction, egress, port, protocol, tcp
test #39: direction,egress,numbered-port,port,protocol,tcp
 - tags: direction, egress, numbered-port, port, protocol, tcp
test #40: direction,egress,numbered-port,port,protocol,tcp
 - tags: direction, egress, numbered-port, port, protocol, tcp
test #41: any-port,direction,egress,port,protocol,udp
 - tags: any-port, direction, egress, port, protocol, udp
test #42: direction,egress,numbered-port,port,protocol,udp
 - tags: direction, egress, numbered-port, port, protocol, udp
test #43: direction,egress,numbered-port,port,protocol,udp
 - tags: direction, egress, numbered-port, port, protocol, udp
test #44: any-port,direction,egress,port,protocol,sctp
 - tags: any-port, direction, egress, port, protocol, sctp
test #45: direction,egress,numbered-port,port,protocol,sctp
 - tags: direction, egress, numbered-port, port, protocol, sctp
test #46: direction,egress,numbered-port,port,protocol,sctp
 - tags: direction, egress, numbered-port, port, protocol, sctp
test #47: direction,egress,named-port,port,protocol,tcp
 - tags: direction, egress, named-port, port, protocol, tcp
test #48: direction,egress,named-port,port,protocol,tcp
 - tags: direction, egress, named-port, port, protocol, tcp
test #49: direction,egress,named-port,port,protocol,udp
 - tags: direction, egress, named-port, port, protocol, udp
test #50: direction,egress,named-port,port,protocol,udp
 - tags: direction, egress, named-port, port, protocol, udp
test #51: direction,egress,named-port,port,protocol,sctp
 - tags: direction, egress, named-port, port, protocol, sctp
test #52: direction,egress,named-port,port,protocol,sctp
 - tags: direction, egress, named-port, port, protocol, sctp
test #53: open a named port that doesn't match its protocol
 - tags: direction, egress, miscellaneous, named-port, pathological, port, protocol, tcp
test #54: open a named port that isn't served
 - tags: direction, egress, miscellaneous, named-port, pathological, port, protocol, tcp
test #55: open a numbered port that isn't served
 - tags: direction, egress, miscellaneous, numbered-port, pathological, port, protocol, tcp
test #56: any-port,direction,ingress,port
 - tags: any-port, direction, ingress, port
test #57: direction,ingress,numbered-port,port
 - tags: direction, ingress, numbered-port, port
test #58: direction,ingress,numbered-port,port
 - tags: direction, ingress, numbered-port, port
test #59: any-port,direction,ingress,port,protocol,tcp
 - tags: any-port, direction, ingress, port, protocol, tcp
test #60: direction,ingress,numbered-port,port,protocol,tcp
 - tags: direction, ingress, numbered-port, port, protocol, tcp
test #61: direction,ingress,numbered-port,port,protocol,tcp
 - tags: direction, ingress, numbered-port, port, protocol, tcp
test #62: any-port,direction,ingress,port,protocol,udp
 - tags: any-port, direction, ingress, port, protocol, udp
test #63: direction,ingress,numbered-port,port,protocol,udp
 - tags: direction, ingress, numbered-port, port, protocol, udp
test #64: direction,ingress,numbered-port,port,protocol,udp
 - tags: direction, ingress, numbered-port, port, protocol, udp
test #65: any-port,direction,ingress,port,protocol,sctp
 - tags: any-port, direction, ingress, port, protocol, sctp
test #66: direction,ingress,numbered-port,port,protocol,sctp
 - tags: direction, ingress, numbered-port, port, protocol, sctp
test #67: direction,ingress,numbered-port,port,protocol,sctp
 - tags: direction, ingress, numbered-port, port, protocol, sctp
test #68: direction,ingress,named-port,port,protocol,tcp
 - tags: direction, ingress, named-port, port, protocol, tcp
test #69: direction,ingress,named-port,port,protocol,tcp
 - tags: direction, ingress, named-port, port, protocol, tcp
test #70: direction,ingress,named-port,port,protocol,udp
 - tags: direction, ingress, named-port, port, protocol, udp
test #71: direction,ingress,named-port,port,protocol,udp
 - tags: direction, ingress, named-port, port, protocol, udp
test #72: direction,ingress,named-port,port,protocol,sctp
 - tags: direction, ingress, named-port, port, protocol, sctp
test #73: direction,ingress,named-port,port,protocol,sctp
 - tags: direction, ingress, named-port, port, protocol, sctp
test #74: open a named port that doesn't match its protocol
 - tags: direction, ingress, miscellaneous, named-port, pathological, port, protocol, tcp
test #75: open a named port that isn't served
 - tags: direction, ingress, miscellaneous, named-port, pathological, port, protocol, tcp
test #76: open a numbered port that isn't served
 - tags: direction, ingress, miscellaneous, numbered-port, pathological, port, protocol, tcp
test #77: any-port,direction,egress,multi-port/protocol,numbered-port,port,rule
 - tags: any-port, direction, egress, multi-port/protocol, numbered-port, port, rule
test #78: any-port,direction,egress,multi-port/protocol,named-port,port,rule
 - tags: any-port, direction, egress, multi-port/protocol, named-port, port, rule
test #79: any-port,direction,egress,multi-port/protocol,port,protocol,rule,udp
 - tags: any-port, direction, egress, multi-port/protocol, port, protocol, rule, udp
test #80: direction,egress,multi-port/protocol,numbered-port,port,rule
 - tags: direction, egress, multi-port/protocol, numbered-port, port, rule
test #81: direction,egress,multi-port/protocol,named-port,numbered-port,port,rule
 - tags: direction, egress, multi-port/protocol, named-port, numbered-port, port, rule
test #82: direction,egress,multi-port/protocol,named-port,numbered-port,port,protocol,rule,udp
 - tags: direction, egress, multi-port/protocol, named-port, numbered-port, port, protocol, rule, udp
test #83: direction,egress,multi-port/protocol,named-port,numbered-port,port,protocol,rule,udp
 - tags: direction, egress, multi-port/protocol, named-port, numbered-port, port, protocol, rule, udp
test #84: any-port,direction,ingress,multi-port/protocol,numbered-port,port,rule
 - tags: any-port, direction, ingress, multi-port/protocol, numbered-port, port, rule
test #85: any-port,direction,ingress,multi-port/protocol,named-port,port,rule
 - tags: any-port, direction, ingress, multi-port/protocol, named-port, port, rule
test #86: any-port,direction,ingress,multi-port/protocol,port,protocol,rule,udp
 - tags: any-port, direction, ingress, multi-port/protocol, port, protocol, rule, udp
test #87: direction,ingress,multi-port/protocol,numbered-port,port,rule
 - tags: direction, ingress, multi-port/protocol, numbered-port, port, rule
test #88: direction,ingress,multi-port/protocol,named-port,numbered-port,port,rule
 - tags: direction, ingress, multi-port/protocol, named-port, numbered-port, port, rule
test #89: direction,ingress,multi-port/protocol,named-port,numbered-port,port,protocol,rule,udp
 - tags: direction, ingress, multi-port/protocol, named-port, numbered-port, port, protocol, rule, udp
test #90: direction,ingress,multi-port/protocol,named-port,numbered-port,port,protocol,rule,udp
 - tags: direction, ingress, multi-port/protocol, named-port, numbered-port, port, protocol, rule, udp
test #91: Create/delete policy
 - tags: action, create-policy, delete-policy
test #92: Create/update policy
 - tags: action, create-policy, update-policy
test #93: Create/delete namespace
 - tags: action, create-namespace, delete-namespace
test #94: Update namespace so that policy applies, then again so it no longer applies
 - tags: action, set-namespace-labels
test #95: Create/delete pod
 - tags: action, create-pod, delete-pod
test #96: Update pod so that policy applies, then again so it no longer applies
 - tags: action, set-pod-labels
test #97: deny all from source, allow all to dest
 - tags: allow-all, conflict, deny-all, direction, egress, ingress, miscellaneous, rule
test #98: allow all from source, deny all to dest
 - tags: allow-all, conflict, deny-all, direction, egress, ingress, miscellaneous, rule
test #99: deny all + allow all from same source
 - tags: allow-all, conflict, deny-all, direction, egress, miscellaneous, rule
test #100: deny all + allow all to same dest
 - tags: allow-all, conflict, deny-all, direction, ingress, miscellaneous, rule
test #101: deny all + allow all by pod from same source
 - tags: all-namespaces, all-pods, conflict, deny-all, direction, egress, miscellaneous, peer-pods, rule
test #102: deny all + allow all by IP from same source
 - tags: conflict, deny-all, direction, egress, miscellaneous, rule
test #103: deny all by IP + allow all by pod from same source
 - tags: all-namespaces, all-pods, conflict, direction, egress, miscellaneous, peer-pods
test #104: deny all by pod + allow all by IP from same source
 - tags: conflict, direction, egress, miscellaneous
test #105: deny all + allow all by pod to same source
 - tags: all-namespaces, all-pods, conflict, deny-all, direction, ingress, miscellaneous, peer-pods, rule
test #106: deny all + allow all by IP to same source
 - tags: conflict, deny-all, direction, ingress, miscellaneous, rule
test #107: deny all by IP + allow all by pod to same source
 - tags: all-namespaces, all-pods, conflict, direction, ingress, miscellaneous, peer-pods
test #108: deny all by pod + allow all by IP to same source
 - tags: conflict, direction, ingress, miscellaneous
test #109: egress: deny all by IP
 - tags: conflict, direction, egress, miscellaneous
test #110: egress: deny all by pod
 - tags: conflict, direction, egress, miscellaneous
test #111: ingress: deny all by IP
 - tags: conflict, direction, ingress, miscellaneous
test #112: ingress: deny all by pod
 - tags: conflict, direction, ingress, miscellaneous
starting test case #1
time="2021-04-29T00:14:47Z" level=info msg="cluster state reset"
time="2021-04-29T00:14:50Z" level=info msg="cluster state verified"
time="2021-04-29T00:14:50Z" level=info msg="step 1: waiting 5 seconds for perturbation to take effect"
time="2021-04-29T00:14:55Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-04-29T00:14:55Z" level=info msg="running kube probe on try 1"
time="2021-04-29T00:20:34Z" level=info msg="running kube probe on try 2"
evaluating test case: set namespace to x
step 1 on all available ports/protocols:
Policy explanation:
+---------+---------------+--------------+-------------------------------+-------------------------+
|  TYPE   |    TARGET     | SOURCE RULES |             PEER              |      PORT/PROTOCOL      |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Ingress | namespace: x  | x/base       | namespace: Match expressions: | port 80 on protocol TCP |
|         | Match labels: |              |   ns In [x y]                 |                         |
|         |   pod: a      |              | pods: Match expressions:      |                         |
|         |               |              |   pod In [b c]                |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
|         |               |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Egress  | namespace: x  | x/base       | all pods, all ips             | port 53 on protocol UDP |
|         | Match labels: |              |                               | port 53 on protocol TCP |
|         |   pod: a      |              |                               |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP |
|         |               |              |   ns In [y z]                 |                         |
|         |               |              | pods: Match expressions:      |                         |
|         |               |              |   pod In [a b]                |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: base
  namespace: x
spec:
  egress:
  - ports:
    - port: 80
      protocol: TCP
    to:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - "y"
          - z
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - a
          - b
  - ports:
    - port: 53
      protocol: UDP
    - port: 53
      protocol: TCP
  ingress:
  - from:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - x
          - "y"
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - b
          - c
    ports:
    - port: 80
      protocol: TCP
  podSelector:
    matchLabels:
      pod: a
  policyTypes:
  - Ingress
  - Egress

Discrepancy found:64 wrong, 9 ignored, 8 correct
Expected ingress:
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| SCTP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| SCTP/81 |     |     |     |     |     |     |     |     |     |
| TCP/80  |     |     |     |     |     |     |     |     |     |
| TCP/81  |     |     |     |     |     |     |     |     |     |
| UDP/80  |     |     |     |     |     |     |     |     |     |
| UDP/81  |     |     |     |     |     |     |     |     |     |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

Expected egress:
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| SCTP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| SCTP/81 |     |     |     |     |     |     |     |     |     |
| TCP/80  |     |     |     |     |     |     |     |     |     |
| TCP/81  |     |     |     |     |     |     |     |     |     |
| UDP/80  |     |     |     |     |     |     |     |     |     |
| UDP/81  |     |     |     |     |     |     |     |     |     |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

Expected combined:
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| SCTP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| SCTP/81 |     |     |     |     |     |     |     |     |     |
| TCP/80  |     |     |     |     |     |     |     |     |     |
| TCP/81  |     |     |     |     |     |     |     |     |     |
| UDP/80  |     |     |     |     |     |     |     |     |     |
| UDP/81  |     |     |     |     |     |     |     |     |     |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

kube results, try 0:
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| SCTP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| SCTP/81 |     |     |     |     |     |     |     |     |     |
| TCP/80  |     |     |     |     |     |     |     |     |     |
| TCP/81  |     |     |     |     |     |     |     |     |     |
| UDP/80  |     |     |     |     |     |     |     |     |     |
| UDP/81  |     |     |     |     |     |     |     |     |     |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

kube results, try 1:
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| SCTP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| SCTP/81 |     |     |     |     |     |     |     |     |     |
| TCP/80  |     |     |     |     |     |     |     |     |     |
| TCP/81  |     |     |     |     |     |     |     |     |     |
| UDP/80  |     |     |     |     |     |     |     |     |     |
| UDP/81  |     |     |     |     |     |     |     |     |     |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+


Actual vs expected (last round):
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+
|     | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a | .   | .   | .   | X   | X   | .   | X   | X   | .   |
| x/b | X   | X   | X   | X   | X   | X   | X   | X   | X   |
| x/c | X   | X   | X   | X   | X   | X   | X   | X   | X   |
| y/a | .   | X   | X   | X   | X   | X   | X   | X   | X   |
| y/b | X   | X   | X   | X   | X   | X   | X   | X   | X   |
| y/c | X   | X   | X   | X   | X   | X   | X   | X   | X   |
| z/a | .   | X   | X   | X   | X   | X   | X   | X   | X   |
| z/b | .   | X   | X   | X   | X   | X   | X   | X   | X   |
| z/c | .   | X   | X   | X   | X   | X   | X   | X   | X   |
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+



finished policy #1
starting test case #2
time="2021-04-29T00:26:13Z" level=info msg="cluster state reset"
time="2021-04-29T00:26:16Z" level=info msg="cluster state verified"
time="2021-04-29T00:26:16Z" level=info msg="step 1: waiting 5 seconds for perturbation to take effect"
time="2021-04-29T00:26:21Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-04-29T00:26:21Z" level=info msg="running kube probe on try 1"
time="2021-04-29T00:31:56Z" level=info msg="running kube probe on try 2"
evaluating test case: set namespace to y
step 1 on all available ports/protocols:
Policy explanation:
+---------+---------------+--------------+-------------------------------+-------------------------+
|  TYPE   |    TARGET     | SOURCE RULES |             PEER              |      PORT/PROTOCOL      |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Ingress | namespace: y  | y/base       | namespace: Match expressions: | port 80 on protocol TCP |
|         | Match labels: |              |   ns In [x y]                 |                         |
|         |   pod: a      |              | pods: Match expressions:      |                         |
|         |               |              |   pod In [b c]                |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
|         |               |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Egress  | namespace: y  | y/base       | all pods, all ips             | port 53 on protocol UDP |
|         | Match labels: |              |                               | port 53 on protocol TCP |
|         |   pod: a      |              |                               |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP |
|         |               |              |   ns In [y z]                 |                         |
|         |               |              | pods: Match expressions:      |                         |
|         |               |              |   pod In [a b]                |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: base
  namespace: "y"
spec:
  egress:
  - ports:
    - port: 80
      protocol: TCP
    to:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - "y"
          - z
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - a
          - b
  - ports:
    - port: 53
      protocol: UDP
    - port: 53
      protocol: TCP
  ingress:
  - from:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - x
          - "y"
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - b
          - c
    ports:
    - port: 80
      protocol: TCP
  podSelector:
    matchLabels:
      pod: a
  policyTypes:
  - Ingress
  - Egress

Discrepancy found:63 wrong, 9 ignored, 9 correct
Expected ingress:
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| SCTP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| SCTP/81 |     |     |     |     |     |     |     |     |     |
| TCP/80  |     |     |     |     |     |     |     |     |     |
| TCP/81  |     |     |     |     |     |     |     |     |     |
| UDP/80  |     |     |     |     |     |     |     |     |     |
| UDP/81  |     |     |     |     |     |     |     |     |     |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a     | .   | .   | .   | X   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | X   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | X   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | X   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | X   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | X   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b     | .   | .   | .   | X   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | X   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | X   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | X   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | X   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c     | .   | .   | .   | X   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | X   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | X   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | X   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | X   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a     | .   | .   | .   | X   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | X   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | X   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | X   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | X   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | X   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b     | .   | .   | .   | X   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | X   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | X   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | X   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | X   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c     | .   | .   | .   | X   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | X   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | X   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | X   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | X   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a     | .   | .   | .   | X   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | X   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | X   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | X   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | X   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | X   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b     | .   | .   | .   | X   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | X   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | X   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | X   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | X   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | X   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c     | .   | .   | .   | X   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | X   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | X   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | X   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | X   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | X   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

Expected egress:
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| SCTP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| SCTP/81 |     |     |     |     |     |     |     |     |     |
| TCP/80  |     |     |     |     |     |     |     |     |     |
| TCP/81  |     |     |     |     |     |     |     |     |     |
| UDP/80  |     |     |     |     |     |     |     |     |     |
| UDP/81  |     |     |     |     |     |     |     |     |     |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

Expected combined:
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| SCTP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| SCTP/81 |     |     |     |     |     |     |     |     |     |
| TCP/80  |     |     |     |     |     |     |     |     |     |
| TCP/81  |     |     |     |     |     |     |     |     |     |
| UDP/80  |     |     |     |     |     |     |     |     |     |
| UDP/81  |     |     |     |     |     |     |     |     |     |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a     | .   | .   | .   | X   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | X   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | X   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | X   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | X   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | X   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b     | .   | .   | .   | X   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | X   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | X   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | X   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | X   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c     | .   | .   | .   | X   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | X   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | X   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | X   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | X   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | .   | X   | .   | .   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b     | .   | .   | .   | X   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | X   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | X   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | X   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | X   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c     | .   | .   | .   | X   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | X   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | X   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | X   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | X   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a     | .   | .   | .   | X   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | X   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | X   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | X   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | X   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | X   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b     | .   | .   | .   | X   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | X   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | X   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | X   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | X   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | X   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c     | .   | .   | .   | X   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | X   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | X   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | X   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | X   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | X   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

kube results, try 0:
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| SCTP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| SCTP/81 |     |     |     |     |     |     |     |     |     |
| TCP/80  |     |     |     |     |     |     |     |     |     |
| TCP/81  |     |     |     |     |     |     |     |     |     |
| UDP/80  |     |     |     |     |     |     |     |     |     |
| UDP/81  |     |     |     |     |     |     |     |     |     |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

kube results, try 1:
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| SCTP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| SCTP/81 |     |     |     |     |     |     |     |     |     |
| TCP/80  |     |     |     |     |     |     |     |     |     |
| TCP/81  |     |     |     |     |     |     |     |     |     |
| UDP/80  |     |     |     |     |     |     |     |     |     |
| UDP/81  |     |     |     |     |     |     |     |     |     |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+


Actual vs expected (last round):
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+
|     | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a | X   | X   | X   | .   | X   | X   | X   | X   | X   |
| x/b | X   | X   | X   | X   | X   | X   | X   | X   | X   |
| x/c | X   | X   | X   | X   | X   | X   | X   | X   | X   |
| y/a | .   | .   | .   | .   | X   | .   | X   | X   | .   |
| y/b | X   | X   | X   | X   | X   | X   | X   | X   | X   |
| y/c | X   | X   | X   | X   | X   | X   | X   | X   | X   |
| z/a | X   | X   | X   | .   | X   | X   | X   | X   | X   |
| z/b | X   | X   | X   | .   | X   | X   | X   | X   | X   |
| z/c | X   | X   | X   | .   | X   | X   | X   | X   | X   |
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+



finished policy #2
starting test case #3
time="2021-04-29T00:37:33Z" level=info msg="cluster state reset"
time="2021-04-29T00:37:36Z" level=info msg="cluster state verified"
time="2021-04-29T00:37:36Z" level=info msg="step 1: waiting 5 seconds for perturbation to take effect"
time="2021-04-29T00:37:41Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-04-29T00:37:41Z" level=info msg="running kube probe on try 1"
time="2021-04-29T00:43:14Z" level=info msg="running kube probe on try 2"
evaluating test case: set namespace to z
step 1 on all available ports/protocols:
Policy explanation:
+---------+---------------+--------------+-------------------------------+-------------------------+
|  TYPE   |    TARGET     | SOURCE RULES |             PEER              |      PORT/PROTOCOL      |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Ingress | namespace: z  | z/base       | namespace: Match expressions: | port 80 on protocol TCP |
|         | Match labels: |              |   ns In [x y]                 |                         |
|         |   pod: a      |              | pods: Match expressions:      |                         |
|         |               |              |   pod In [b c]                |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
|         |               |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Egress  | namespace: z  | z/base       | all pods, all ips             | port 53 on protocol UDP |
|         | Match labels: |              |                               | port 53 on protocol TCP |
|         |   pod: a      |              |                               |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP |
|         |               |              |   ns In [y z]                 |                         |
|         |               |              | pods: Match expressions:      |                         |
|         |               |              |   pod In [a b]                |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: base
  namespace: z
spec:
  egress:
  - ports:
    - port: 80
      protocol: TCP
    to:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - "y"
          - z
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - a
          - b
  - ports:
    - port: 53
      protocol: UDP
    - port: 53
      protocol: TCP
  ingress:
  - from:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - x
          - "y"
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - b
          - c
    ports:
    - port: 80
      protocol: TCP
  podSelector:
    matchLabels:
      pod: a
  policyTypes:
  - Ingress
  - Egress

Discrepancy found:63 wrong, 9 ignored, 9 correct
Expected ingress:
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| SCTP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| SCTP/81 |     |     |     |     |     |     |     |     |     |
| TCP/80  |     |     |     |     |     |     |     |     |     |
| TCP/81  |     |     |     |     |     |     |     |     |     |
| UDP/80  |     |     |     |     |     |     |     |     |     |
| UDP/81  |     |     |     |     |     |     |     |     |     |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a     | .   | .   | .   | .   | .   | .   | X   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | X   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | X   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | X   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | X   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | X   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b     | .   | .   | .   | .   | .   | .   | X   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | X   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | X   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | X   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | X   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c     | .   | .   | .   | .   | .   | .   | X   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | X   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | X   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | X   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | X   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a     | .   | .   | .   | .   | .   | .   | X   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | X   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | X   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | X   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | X   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | X   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b     | .   | .   | .   | .   | .   | .   | X   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | X   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | X   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | X   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | X   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c     | .   | .   | .   | .   | .   | .   | X   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | X   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | X   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | X   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | X   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a     | .   | .   | .   | .   | .   | .   | X   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | X   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | X   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | X   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | X   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | X   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b     | .   | .   | .   | .   | .   | .   | X   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | X   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | X   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | X   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | X   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | X   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c     | .   | .   | .   | .   | .   | .   | X   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | X   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | X   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | X   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | X   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | X   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

Expected egress:
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| SCTP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| SCTP/81 |     |     |     |     |     |     |     |     |     |
| TCP/80  |     |     |     |     |     |     |     |     |     |
| TCP/81  |     |     |     |     |     |     |     |     |     |
| UDP/80  |     |     |     |     |     |     |     |     |     |
| UDP/81  |     |     |     |     |     |     |     |     |     |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

Expected combined:
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| SCTP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| SCTP/81 |     |     |     |     |     |     |     |     |     |
| TCP/80  |     |     |     |     |     |     |     |     |     |
| TCP/81  |     |     |     |     |     |     |     |     |     |
| UDP/80  |     |     |     |     |     |     |     |     |     |
| UDP/81  |     |     |     |     |     |     |     |     |     |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a     | .   | .   | .   | .   | .   | .   | X   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | X   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | X   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | X   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | X   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | X   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b     | .   | .   | .   | .   | .   | .   | X   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | X   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | X   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | X   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | X   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c     | .   | .   | .   | .   | .   | .   | X   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | X   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | X   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | X   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | X   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a     | .   | .   | .   | .   | .   | .   | X   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | X   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | X   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | X   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | X   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | X   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b     | .   | .   | .   | .   | .   | .   | X   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | X   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | X   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | X   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | X   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c     | .   | .   | .   | .   | .   | .   | X   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | X   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | X   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | X   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | X   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | .   | .   | X   | X   | .   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b     | .   | .   | .   | .   | .   | .   | X   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | X   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | X   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | X   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | X   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | X   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c     | .   | .   | .   | .   | .   | .   | X   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | X   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | X   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | X   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | X   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | X   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

kube results, try 0:
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| SCTP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| SCTP/81 |     |     |     |     |     |     |     |     |     |
| TCP/80  |     |     |     |     |     |     |     |     |     |
| TCP/81  |     |     |     |     |     |     |     |     |     |
| UDP/80  |     |     |     |     |     |     |     |     |     |
| UDP/81  |     |     |     |     |     |     |     |     |     |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

kube results, try 1:
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| SCTP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| SCTP/81 |     |     |     |     |     |     |     |     |     |
| TCP/80  |     |     |     |     |     |     |     |     |     |
| TCP/81  |     |     |     |     |     |     |     |     |     |
| UDP/80  |     |     |     |     |     |     |     |     |     |
| UDP/81  |     |     |     |     |     |     |     |     |     |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+


Actual vs expected (last round):
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+
|     | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a | X   | X   | X   | X   | X   | X   | .   | X   | X   |
| x/b | X   | X   | X   | X   | X   | X   | X   | X   | X   |
| x/c | X   | X   | X   | X   | X   | X   | X   | X   | X   |
| y/a | X   | X   | X   | X   | X   | X   | .   | X   | X   |
| y/b | X   | X   | X   | X   | X   | X   | X   | X   | X   |
| y/c | X   | X   | X   | X   | X   | X   | X   | X   | X   |
| z/a | .   | .   | .   | X   | X   | .   | .   | X   | .   |
| z/b | X   | X   | X   | X   | X   | X   | .   | X   | X   |
| z/c | X   | X   | X   | X   | X   | X   | .   | X   | X   |
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+



finished policy #3
starting test case #4
time="2021-04-29T00:48:52Z" level=info msg="cluster state reset"
time="2021-04-29T00:48:55Z" level=info msg="cluster state verified"
time="2021-04-29T00:48:55Z" level=info msg="step 1: waiting 5 seconds for perturbation to take effect"
time="2021-04-29T00:49:00Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-04-29T00:49:00Z" level=info msg="running kube probe on try 1"
time="2021-04-29T00:54:33Z" level=info msg="running kube probe on try 2"
evaluating test case: set pod selector to ["MatchLabels",null,"MatchExpression",null]
step 1 on all available ports/protocols:
Policy explanation:
+---------+--------------+--------------+-------------------------------+-------------------------+
|  TYPE   |    TARGET    | SOURCE RULES |             PEER              |      PORT/PROTOCOL      |
+---------+--------------+--------------+-------------------------------+-------------------------+
| Ingress | namespace: x | x/base       | namespace: Match expressions: | port 80 on protocol TCP |
|         | all pods     |              |   ns In [x y]                 |                         |
|         |              |              | pods: Match expressions:      |                         |
|         |              |              |   pod In [b c]                |                         |
+---------+--------------+--------------+-------------------------------+-------------------------+
|         |              |              |                               |                         |
+---------+--------------+--------------+-------------------------------+-------------------------+
| Egress  | namespace: x | x/base       | all pods, all ips             | port 53 on protocol UDP |
|         | all pods     |              |                               | port 53 on protocol TCP |
+         +              +              +-------------------------------+-------------------------+
|         |              |              | namespace: Match expressions: | port 80 on protocol TCP |
|         |              |              |   ns In [y z]                 |                         |
|         |              |              | pods: Match expressions:      |                         |
|         |              |              |   pod In [a b]                |                         |
+---------+--------------+--------------+-------------------------------+-------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: base
  namespace: x
spec:
  egress:
  - ports:
    - port: 80
      protocol: TCP
    to:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - "y"
          - z
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - a
          - b
  - ports:
    - port: 53
      protocol: UDP
    - port: 53
      protocol: TCP
  ingress:
  - from:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - x
          - "y"
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - b
          - c
    ports:
    - port: 80
      protocol: TCP
  podSelector: {}
  policyTypes:
  - Ingress
  - Egress

Discrepancy found:48 wrong, 9 ignored, 24 correct
Expected ingress:
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| SCTP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| SCTP/81 |     |     |     |     |     |     |     |     |     |
| TCP/80  |     |     |     |     |     |     |     |     |     |
| TCP/81  |     |     |     |     |     |     |     |     |     |
| UDP/80  |     |     |     |     |     |     |     |     |     |
| UDP/81  |     |     |     |     |     |     |     |     |     |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a     | X   | X   | X   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | X   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | X   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | X   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | X   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | X   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b     | X   | X   | X   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | X   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | X   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | X   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | X   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c     | X   | X   | X   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | X   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | X   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | X   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | X   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a     | X   | X   | X   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | X   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | X   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | X   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | X   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | X   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b     | X   | X   | X   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | X   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | X   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | X   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | X   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c     | X   | X   | X   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | X   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | X   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | X   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | X   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a     | X   | X   | X   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | X   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | X   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | X   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | X   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | X   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b     | X   | X   | X   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | X   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | X   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | X   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | X   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | X   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c     | X   | X   | X   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | X   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | X   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | X   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | X   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | X   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

Expected egress:
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| SCTP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| SCTP/81 |     |     |     |     |     |     |     |     |     |
| TCP/80  |     |     |     |     |     |     |     |     |     |
| TCP/81  |     |     |     |     |     |     |     |     |     |
| UDP/80  |     |     |     |     |     |     |     |     |     |
| UDP/81  |     |     |     |     |     |     |     |     |     |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

Expected combined:
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| SCTP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| SCTP/81 |     |     |     |     |     |     |     |     |     |
| TCP/80  |     |     |     |     |     |     |     |     |     |
| TCP/81  |     |     |     |     |     |     |     |     |     |
| UDP/80  |     |     |     |     |     |     |     |     |     |
| UDP/81  |     |     |     |     |     |     |     |     |     |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a     | X   | X   | X   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | X   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | X   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | X   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | X   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | X   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b     | X   | X   | X   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | X   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | X   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | X   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | X   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c     | X   | X   | X   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | X   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | X   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | X   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | X   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a     | X   | X   | X   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | X   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | X   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | X   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | X   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | X   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b     | X   | X   | X   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | X   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | X   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | X   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | X   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | X   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c     | X   | X   | X   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | X   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | X   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | X   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | X   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | X   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

kube results, try 0:
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| SCTP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| SCTP/81 |     |     |     |     |     |     |     |     |     |
| TCP/80  |     |     |     |     |     |     |     |     |     |
| TCP/81  |     |     |     |     |     |     |     |     |     |
| UDP/80  |     |     |     |     |     |     |     |     |     |
| UDP/81  |     |     |     |     |     |     |     |     |     |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

kube results, try 1:
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| SCTP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| SCTP/81 |     |     |     |     |     |     |     |     |     |
| TCP/80  |     |     |     |     |     |     |     |     |     |
| TCP/81  |     |     |     |     |     |     |     |     |     |
| UDP/80  |     |     |     |     |     |     |     |     |     |
| UDP/81  |     |     |     |     |     |     |     |     |     |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+


Actual vs expected (last round):
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+
|     | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a | .   | .   | .   | X   | X   | .   | X   | X   | .   |
| x/b | .   | .   | .   | X   | X   | .   | X   | X   | .   |
| x/c | .   | .   | .   | X   | X   | .   | X   | X   | .   |
| y/a | .   | .   | .   | X   | X   | X   | X   | X   | X   |
| y/b | X   | X   | X   | X   | X   | X   | X   | X   | X   |
| y/c | X   | X   | X   | X   | X   | X   | X   | X   | X   |
| z/a | .   | .   | .   | X   | X   | X   | X   | X   | X   |
| z/b | .   | .   | .   | X   | X   | X   | X   | X   | X   |
| z/c | .   | .   | .   | X   | X   | X   | X   | X   | X   |
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+



finished policy #4
starting test case #5
time="2021-04-29T01:00:09Z" level=info msg="cluster state reset"
time="2021-04-29T01:00:12Z" level=info msg="cluster state verified"
time="2021-04-29T01:00:12Z" level=info msg="step 1: waiting 5 seconds for perturbation to take effect"
time="2021-04-29T01:00:17Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-04-29T01:00:18Z" level=info msg="running kube probe on try 1"
time="2021-04-29T01:05:51Z" level=info msg="running kube probe on try 2"
evaluating test case: set pod selector to ["MatchLabels",["pod: a"],"MatchExpression",null]
step 1 on all available ports/protocols:
Policy explanation:
+---------+---------------+--------------+-------------------------------+-------------------------+
|  TYPE   |    TARGET     | SOURCE RULES |             PEER              |      PORT/PROTOCOL      |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Ingress | namespace: x  | x/base       | namespace: Match expressions: | port 80 on protocol TCP |
|         | Match labels: |              |   ns In [x y]                 |                         |
|         |   pod: a      |              | pods: Match expressions:      |                         |
|         |               |              |   pod In [b c]                |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
|         |               |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Egress  | namespace: x  | x/base       | all pods, all ips             | port 53 on protocol UDP |
|         | Match labels: |              |                               | port 53 on protocol TCP |
|         |   pod: a      |              |                               |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP |
|         |               |              |   ns In [y z]                 |                         |
|         |               |              | pods: Match expressions:      |                         |
|         |               |              |   pod In [a b]                |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: base
  namespace: x
spec:
  egress:
  - ports:
    - port: 80
      protocol: TCP
    to:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - "y"
          - z
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - a
          - b
  - ports:
    - port: 53
      protocol: UDP
    - port: 53
      protocol: TCP
  ingress:
  - from:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - x
          - "y"
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - b
          - c
    ports:
    - port: 80
      protocol: TCP
  podSelector:
    matchLabels:
      pod: a
  policyTypes:
  - Ingress
  - Egress

Discrepancy found:64 wrong, 9 ignored, 8 correct
Expected ingress:
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| SCTP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| SCTP/81 |     |     |     |     |     |     |     |     |     |
| TCP/80  |     |     |     |     |     |     |     |     |     |
| TCP/81  |     |     |     |     |     |     |     |     |     |
| UDP/80  |     |     |     |     |     |     |     |     |     |
| UDP/81  |     |     |     |     |     |     |     |     |     |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

Expected egress:
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| SCTP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| SCTP/81 |     |     |     |     |     |     |     |     |     |
| TCP/80  |     |     |     |     |     |     |     |     |     |
| TCP/81  |     |     |     |     |     |     |     |     |     |
| UDP/80  |     |     |     |     |     |     |     |     |     |
| UDP/81  |     |     |     |     |     |     |     |     |     |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

Expected combined:
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| SCTP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| SCTP/81 |     |     |     |     |     |     |     |     |     |
| TCP/80  |     |     |     |     |     |     |     |     |     |
| TCP/81  |     |     |     |     |     |     |     |     |     |
| UDP/80  |     |     |     |     |     |     |     |     |     |
| UDP/81  |     |     |     |     |     |     |     |     |     |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

kube results, try 0:
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| SCTP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| SCTP/81 |     |     |     |     |     |     |     |     |     |
| TCP/80  |     |     |     |     |     |     |     |     |     |
| TCP/81  |     |     |     |     |     |     |     |     |     |
| UDP/80  |     |     |     |     |     |     |     |     |     |
| UDP/81  |     |     |     |     |     |     |     |     |     |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

kube results, try 1:
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| SCTP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| SCTP/81 |     |     |     |     |     |     |     |     |     |
| TCP/80  |     |     |     |     |     |     |     |     |     |
| TCP/81  |     |     |     |     |     |     |     |     |     |
| UDP/80  |     |     |     |     |     |     |     |     |     |
| UDP/81  |     |     |     |     |     |     |     |     |     |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+


Actual vs expected (last round):
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+
|     | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a | .   | .   | .   | X   | X   | .   | X   | X   | .   |
| x/b | X   | X   | X   | X   | X   | X   | X   | X   | X   |
| x/c | X   | X   | X   | X   | X   | X   | X   | X   | X   |
| y/a | .   | X   | X   | X   | X   | X   | X   | X   | X   |
| y/b | X   | X   | X   | X   | X   | X   | X   | X   | X   |
| y/c | X   | X   | X   | X   | X   | X   | X   | X   | X   |
| z/a | .   | X   | X   | X   | X   | X   | X   | X   | X   |
| z/b | .   | X   | X   | X   | X   | X   | X   | X   | X   |
| z/c | .   | X   | X   | X   | X   | X   | X   | X   | X   |
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+



finished policy #5
starting test case #6
time="2021-04-29T01:11:28Z" level=info msg="cluster state reset"
time="2021-04-29T01:11:31Z" level=info msg="cluster state verified"
time="2021-04-29T01:11:31Z" level=info msg="step 1: waiting 5 seconds for perturbation to take effect"
time="2021-04-29T01:11:36Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-04-29T01:11:36Z" level=info msg="running kube probe on try 1"
time="2021-04-29T01:17:09Z" level=info msg="running kube probe on try 2"
evaluating test case: set pod selector to ["MatchLabels",null,"MatchExpression",[{"key":"pod","operator":"In","values":["a","b"]}]]
step 1 on all available ports/protocols:
Policy explanation:
+---------+--------------------+--------------+-------------------------------+-------------------------+
|  TYPE   |       TARGET       | SOURCE RULES |             PEER              |      PORT/PROTOCOL      |
+---------+--------------------+--------------+-------------------------------+-------------------------+
| Ingress | namespace: x       | x/base       | namespace: Match expressions: | port 80 on protocol TCP |
|         | Match expressions: |              |   ns In [x y]                 |                         |
|         |   pod In [a b]     |              | pods: Match expressions:      |                         |
|         |                    |              |   pod In [b c]                |                         |
+---------+--------------------+--------------+-------------------------------+-------------------------+
|         |                    |              |                               |                         |
+---------+--------------------+--------------+-------------------------------+-------------------------+
| Egress  | namespace: x       | x/base       | all pods, all ips             | port 53 on protocol UDP |
|         | Match expressions: |              |                               | port 53 on protocol TCP |
|         |   pod In [a b]     |              |                               |                         |
+         +                    +              +-------------------------------+-------------------------+
|         |                    |              | namespace: Match expressions: | port 80 on protocol TCP |
|         |                    |              |   ns In [y z]                 |                         |
|         |                    |              | pods: Match expressions:      |                         |
|         |                    |              |   pod In [a b]                |                         |
+---------+--------------------+--------------+-------------------------------+-------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: base
  namespace: x
spec:
  egress:
  - ports:
    - port: 80
      protocol: TCP
    to:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - "y"
          - z
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - a
          - b
  - ports:
    - port: 53
      protocol: UDP
    - port: 53
      protocol: TCP
  ingress:
  - from:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - x
          - "y"
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - b
          - c
    ports:
    - port: 80
      protocol: TCP
  podSelector:
    matchExpressions:
    - key: pod
      operator: In
      values:
      - a
      - b
  policyTypes:
  - Ingress
  - Egress

Discrepancy found:56 wrong, 9 ignored, 16 correct
Expected ingress:
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| SCTP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| SCTP/81 |     |     |     |     |     |     |     |     |     |
| TCP/80  |     |     |     |     |     |     |     |     |     |
| TCP/81  |     |     |     |     |     |     |     |     |     |
| UDP/80  |     |     |     |     |     |     |     |     |     |
| UDP/81  |     |     |     |     |     |     |     |     |     |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a     | X   | X   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b     | X   | X   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c     | X   | X   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a     | X   | X   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b     | X   | X   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c     | X   | X   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a     | X   | X   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b     | X   | X   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c     | X   | X   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

Expected egress:
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| SCTP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| SCTP/81 |     |     |     |     |     |     |     |     |     |
| TCP/80  |     |     |     |     |     |     |     |     |     |
| TCP/81  |     |     |     |     |     |     |     |     |     |
| UDP/80  |     |     |     |     |     |     |     |     |     |
| UDP/81  |     |     |     |     |     |     |     |     |     |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

Expected combined:
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| SCTP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| SCTP/81 |     |     |     |     |     |     |     |     |     |
| TCP/80  |     |     |     |     |     |     |     |     |     |
| TCP/81  |     |     |     |     |     |     |     |     |     |
| UDP/80  |     |     |     |     |     |     |     |     |     |
| UDP/81  |     |     |     |     |     |     |     |     |     |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c     | X   | X   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a     | X   | X   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b     | X   | X   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c     | X   | X   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a     | X   | X   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b     | X   | X   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c     | X   | X   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

kube results, try 0:
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| SCTP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| SCTP/81 |     |     |     |     |     |     |     |     |     |
| TCP/80  |     |     |     |     |     |     |     |     |     |
| TCP/81  |     |     |     |     |     |     |     |     |     |
| UDP/80  |     |     |     |     |     |     |     |     |     |
| UDP/81  |     |     |     |     |     |     |     |     |     |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

kube results, try 1:
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| SCTP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| SCTP/81 |     |     |     |     |     |     |     |     |     |
| TCP/80  |     |     |     |     |     |     |     |     |     |
| TCP/81  |     |     |     |     |     |     |     |     |     |
| UDP/80  |     |     |     |     |     |     |     |     |     |
| UDP/81  |     |     |     |     |     |     |     |     |     |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+


Actual vs expected (last round):
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+
|     | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a | .   | .   | .   | X   | X   | .   | X   | X   | .   |
| x/b | .   | .   | .   | X   | X   | .   | X   | X   | .   |
| x/c | X   | X   | X   | X   | X   | X   | X   | X   | X   |
| y/a | .   | .   | X   | X   | X   | X   | X   | X   | X   |
| y/b | X   | X   | X   | X   | X   | X   | X   | X   | X   |
| y/c | X   | X   | X   | X   | X   | X   | X   | X   | X   |
| z/a | .   | .   | X   | X   | X   | X   | X   | X   | X   |
| z/b | .   | .   | X   | X   | X   | X   | X   | X   | X   |
| z/c | .   | .   | X   | X   | X   | X   | X   | X   | X   |
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+



finished policy #6
starting test case #7
time="2021-04-29T01:22:44Z" level=info msg="cluster state reset"
time="2021-04-29T01:22:47Z" level=info msg="cluster state verified"
time="2021-04-29T01:22:47Z" level=info msg="step 1: waiting 5 seconds for perturbation to take effect"
time="2021-04-29T01:22:52Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-04-29T01:22:52Z" level=info msg="running kube probe on try 1"
time="2021-04-29T01:28:25Z" level=info msg="running kube probe on try 2"
evaluating test case: egress: deny all
step 1 on all available ports/protocols:
Policy explanation:
+---------+---------------+--------------+-------------------------------+-------------------------+
|  TYPE   |    TARGET     | SOURCE RULES |             PEER              |      PORT/PROTOCOL      |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Ingress | namespace: x  | x/base       | namespace: Match expressions: | port 80 on protocol TCP |
|         | Match labels: |              |   ns In [x y]                 |                         |
|         |   pod: a      |              | pods: Match expressions:      |                         |
|         |               |              |   pod In [b c]                |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
|         |               |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Egress  | namespace: x  | x/base       | no pods, no ips               | no ports, no protocols  |
|         | Match labels: |              |                               |                         |
|         |   pod: a      |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: base
  namespace: x
spec:
  ingress:
  - from:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - x
          - "y"
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - b
          - c
    ports:
    - port: 80
      protocol: TCP
  podSelector:
    matchLabels:
      pod: a
  policyTypes:
  - Ingress
  - Egress

Discrepancy found:60 wrong, 9 ignored, 12 correct
Expected ingress:
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| SCTP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| SCTP/81 |     |     |     |     |     |     |     |     |     |
| TCP/80  |     |     |     |     |     |     |     |     |     |
| TCP/81  |     |     |     |     |     |     |     |     |     |
| UDP/80  |     |     |     |     |     |     |     |     |     |
| UDP/81  |     |     |     |     |     |     |     |     |     |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

Expected egress:
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| SCTP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| SCTP/81 |     |     |     |     |     |     |     |     |     |
| TCP/80  |     |     |     |     |     |     |     |     |     |
| TCP/81  |     |     |     |     |     |     |     |     |     |
| UDP/80  |     |     |     |     |     |     |     |     |     |
| UDP/81  |     |     |     |     |     |     |     |     |     |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

Expected combined:
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| SCTP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| SCTP/81 |     |     |     |     |     |     |     |     |     |
| TCP/80  |     |     |     |     |     |     |     |     |     |
| TCP/81  |     |     |     |     |     |     |     |     |     |
| UDP/80  |     |     |     |     |     |     |     |     |     |
| UDP/81  |     |     |     |     |     |     |     |     |     |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

kube results, try 0:
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| SCTP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| SCTP/81 |     |     |     |     |     |     |     |     |     |
| TCP/80  |     |     |     |     |     |     |     |     |     |
| TCP/81  |     |     |     |     |     |     |     |     |     |
| UDP/80  |     |     |     |     |     |     |     |     |     |
| UDP/81  |     |     |     |     |     |     |     |     |     |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

kube results, try 1:
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| SCTP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| SCTP/81 |     |     |     |     |     |     |     |     |     |
| TCP/80  |     |     |     |     |     |     |     |     |     |
| TCP/81  |     |     |     |     |     |     |     |     |     |
| UDP/80  |     |     |     |     |     |     |     |     |     |
| UDP/81  |     |     |     |     |     |     |     |     |     |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+


Actual vs expected (last round):
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+
|     | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a | .   | .   | .   | .   | .   | .   | .   | .   | .   |
| x/b | X   | X   | X   | X   | X   | X   | X   | X   | X   |
| x/c | X   | X   | X   | X   | X   | X   | X   | X   | X   |
| y/a | .   | X   | X   | X   | X   | X   | X   | X   | X   |
| y/b | X   | X   | X   | X   | X   | X   | X   | X   | X   |
| y/c | X   | X   | X   | X   | X   | X   | X   | X   | X   |
| z/a | .   | X   | X   | X   | X   | X   | X   | X   | X   |
| z/b | .   | X   | X   | X   | X   | X   | X   | X   | X   |
| z/c | .   | X   | X   | X   | X   | X   | X   | X   | X   |
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+



finished policy #7
starting test case #8
time="2021-04-29T01:34:02Z" level=info msg="cluster state reset"
time="2021-04-29T01:34:05Z" level=info msg="cluster state verified"
time="2021-04-29T01:34:05Z" level=info msg="step 1: waiting 5 seconds for perturbation to take effect"
time="2021-04-29T01:34:10Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-04-29T01:34:10Z" level=info msg="running kube probe on try 1"
time="2021-04-29T01:39:43Z" level=info msg="running kube probe on try 2"
evaluating test case: egress: allow all
step 1 on all available ports/protocols:
Policy explanation:
+---------+---------------+--------------+-------------------------------+--------------------------+
|  TYPE   |    TARGET     | SOURCE RULES |             PEER              |      PORT/PROTOCOL       |
+---------+---------------+--------------+-------------------------------+--------------------------+
| Ingress | namespace: x  | x/base       | namespace: Match expressions: | port 80 on protocol TCP  |
|         | Match labels: |              |   ns In [x y]                 |                          |
|         |   pod: a      |              | pods: Match expressions:      |                          |
|         |               |              |   pod In [b c]                |                          |
+---------+---------------+--------------+-------------------------------+--------------------------+
|         |               |              |                               |                          |
+---------+---------------+--------------+-------------------------------+--------------------------+
| Egress  | namespace: x  | x/base       | all pods, all ips             | all ports, all protocols |
|         | Match labels: |              |                               |                          |
|         |   pod: a      |              |                               |                          |
+---------+---------------+--------------+-------------------------------+--------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: base
  namespace: x
spec:
  egress:
  - {}
  ingress:
  - from:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - x
          - "y"
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - b
          - c
    ports:
    - port: 80
      protocol: TCP
  podSelector:
    matchLabels:
      pod: a
  policyTypes:
  - Ingress
  - Egress

Discrepancy found:68 wrong, 9 ignored, 4 correct
Expected ingress:
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| SCTP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| SCTP/81 |     |     |     |     |     |     |     |     |     |
| TCP/80  |     |     |     |     |     |     |     |     |     |
| TCP/81  |     |     |     |     |     |     |     |     |     |
| UDP/80  |     |     |     |     |     |     |     |     |     |
| UDP/81  |     |     |     |     |     |     |     |     |     |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

Expected egress:
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| SCTP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| SCTP/81 |     |     |     |     |     |     |     |     |     |
| TCP/80  |     |     |     |     |     |     |     |     |     |
| TCP/81  |     |     |     |     |     |     |     |     |     |
| UDP/80  |     |     |     |     |     |     |     |     |     |
| UDP/81  |     |     |     |     |     |     |     |     |     |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

Expected combined:
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| SCTP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| SCTP/81 |     |     |     |     |     |     |     |     |     |
| TCP/80  |     |     |     |     |     |     |     |     |     |
| TCP/81  |     |     |     |     |     |     |     |     |     |
| UDP/80  |     |     |     |     |     |     |     |     |     |
| UDP/81  |     |     |     |     |     |     |     |     |     |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

kube results, try 0:
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| SCTP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| SCTP/81 |     |     |     |     |     |     |     |     |     |
| TCP/80  |     |     |     |     |     |     |     |     |     |
| TCP/81  |     |     |     |     |     |     |     |     |     |
| UDP/80  |     |     |     |     |     |     |     |     |     |
| UDP/81  |     |     |     |     |     |     |     |     |     |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

kube results, try 1:
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| SCTP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| SCTP/81 |     |     |     |     |     |     |     |     |     |
| TCP/80  |     |     |     |     |     |     |     |     |     |
| TCP/81  |     |     |     |     |     |     |     |     |     |
| UDP/80  |     |     |     |     |     |     |     |     |     |
| UDP/81  |     |     |     |     |     |     |     |     |     |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+


Actual vs expected (last round):
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+
|     | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a | .   | X   | X   | X   | X   | X   | X   | X   | X   |
| x/b | X   | X   | X   | X   | X   | X   | X   | X   | X   |
| x/c | X   | X   | X   | X   | X   | X   | X   | X   | X   |
| y/a | .   | X   | X   | X   | X   | X   | X   | X   | X   |
| y/b | X   | X   | X   | X   | X   | X   | X   | X   | X   |
| y/c | X   | X   | X   | X   | X   | X   | X   | X   | X   |
| z/a | .   | X   | X   | X   | X   | X   | X   | X   | X   |
| z/b | .   | X   | X   | X   | X   | X   | X   | X   | X   |
| z/c | .   | X   | X   | X   | X   | X   | X   | X   | X   |
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+



finished policy #8
starting test case #9
time="2021-04-29T01:45:19Z" level=info msg="cluster state reset"
time="2021-04-29T01:45:22Z" level=info msg="cluster state verified"
time="2021-04-29T01:45:22Z" level=info msg="step 1: waiting 5 seconds for perturbation to take effect"
time="2021-04-29T01:45:27Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-04-29T01:45:27Z" level=info msg="running kube probe on try 1"
time="2021-04-29T01:50:59Z" level=info msg="running kube probe on try 2"
evaluating test case: ingress: deny all
step 1 on all available ports/protocols:
Policy explanation:
+---------+---------------+--------------+-------------------------------+-------------------------+
|  TYPE   |    TARGET     | SOURCE RULES |             PEER              |      PORT/PROTOCOL      |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Ingress | namespace: x  | x/base       | no pods, no ips               | no ports, no protocols  |
|         | Match labels: |              |                               |                         |
|         |   pod: a      |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
|         |               |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Egress  | namespace: x  | x/base       | all pods, all ips             | port 53 on protocol UDP |
|         | Match labels: |              |                               | port 53 on protocol TCP |
|         |   pod: a      |              |                               |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP |
|         |               |              |   ns In [y z]                 |                         |
|         |               |              | pods: Match expressions:      |                         |
|         |               |              |   pod In [a b]                |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: base
  namespace: x
spec:
  egress:
  - ports:
    - port: 80
      protocol: TCP
    to:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - "y"
          - z
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - a
          - b
  - ports:
    - port: 53
      protocol: UDP
    - port: 53
      protocol: TCP
  podSelector:
    matchLabels:
      pod: a
  policyTypes:
  - Ingress
  - Egress

Discrepancy found:60 wrong, 9 ignored, 12 correct
Expected ingress:
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| SCTP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| SCTP/81 |     |     |     |     |     |     |     |     |     |
| TCP/80  |     |     |     |     |     |     |     |     |     |
| TCP/81  |     |     |     |     |     |     |     |     |     |
| UDP/80  |     |     |     |     |     |     |     |     |     |
| UDP/81  |     |     |     |     |     |     |     |     |     |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

Expected egress:
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| SCTP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| SCTP/81 |     |     |     |     |     |     |     |     |     |
| TCP/80  |     |     |     |     |     |     |     |     |     |
| TCP/81  |     |     |     |     |     |     |     |     |     |
| UDP/80  |     |     |     |     |     |     |     |     |     |
| UDP/81  |     |     |     |     |     |     |     |     |     |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

Expected combined:
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| SCTP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| SCTP/81 |     |     |     |     |     |     |     |     |     |
| TCP/80  |     |     |     |     |     |     |     |     |     |
| TCP/81  |     |     |     |     |     |     |     |     |     |
| UDP/80  |     |     |     |     |     |     |     |     |     |
| UDP/81  |     |     |     |     |     |     |     |     |     |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

kube results, try 0:
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| SCTP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| SCTP/81 |     |     |     |     |     |     |     |     |     |
| TCP/80  |     |     |     |     |     |     |     |     |     |
| TCP/81  |     |     |     |     |     |     |     |     |     |
| UDP/80  |     |     |     |     |     |     |     |     |     |
| UDP/81  |     |     |     |     |     |     |     |     |     |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

kube results, try 1:
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| SCTP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| SCTP/81 |     |     |     |     |     |     |     |     |     |
| TCP/80  |     |     |     |     |     |     |     |     |     |
| TCP/81  |     |     |     |     |     |     |     |     |     |
| UDP/80  |     |     |     |     |     |     |     |     |     |
| UDP/81  |     |     |     |     |     |     |     |     |     |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+


Actual vs expected (last round):
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+
|     | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a | .   | .   | .   | X   | X   | .   | X   | X   | .   |
| x/b | .   | X   | X   | X   | X   | X   | X   | X   | X   |
| x/c | .   | X   | X   | X   | X   | X   | X   | X   | X   |
| y/a | .   | X   | X   | X   | X   | X   | X   | X   | X   |
| y/b | .   | X   | X   | X   | X   | X   | X   | X   | X   |
| y/c | .   | X   | X   | X   | X   | X   | X   | X   | X   |
| z/a | .   | X   | X   | X   | X   | X   | X   | X   | X   |
| z/b | .   | X   | X   | X   | X   | X   | X   | X   | X   |
| z/c | .   | X   | X   | X   | X   | X   | X   | X   | X   |
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+



finished policy #9
starting test case #10
time="2021-04-29T01:56:36Z" level=info msg="cluster state reset"
time="2021-04-29T01:56:39Z" level=info msg="cluster state verified"
time="2021-04-29T01:56:39Z" level=info msg="step 1: waiting 5 seconds for perturbation to take effect"
time="2021-04-29T01:56:44Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-04-29T01:56:44Z" level=info msg="running kube probe on try 1"
time="2021-04-29T02:02:16Z" level=info msg="running kube probe on try 2"
evaluating test case: ingress: allow all
step 1 on all available ports/protocols:
Policy explanation:
+---------+---------------+--------------+-------------------------------+--------------------------+
|  TYPE   |    TARGET     | SOURCE RULES |             PEER              |      PORT/PROTOCOL       |
+---------+---------------+--------------+-------------------------------+--------------------------+
| Ingress | namespace: x  | x/base       | all pods, all ips             | all ports, all protocols |
|         | Match labels: |              |                               |                          |
|         |   pod: a      |              |                               |                          |
+---------+---------------+--------------+-------------------------------+--------------------------+
|         |               |              |                               |                          |
+---------+---------------+--------------+-------------------------------+--------------------------+
| Egress  | namespace: x  | x/base       | all pods, all ips             | port 53 on protocol UDP  |
|         | Match labels: |              |                               | port 53 on protocol TCP  |
|         |   pod: a      |              |                               |                          |
+         +               +              +-------------------------------+--------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP  |
|         |               |              |   ns In [y z]                 |                          |
|         |               |              | pods: Match expressions:      |                          |
|         |               |              |   pod In [a b]                |                          |
+---------+---------------+--------------+-------------------------------+--------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: base
  namespace: x
spec:
  egress:
  - ports:
    - port: 80
      protocol: TCP
    to:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - "y"
          - z
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - a
          - b
  - ports:
    - port: 53
      protocol: UDP
    - port: 53
      protocol: TCP
  ingress:
  - {}
  podSelector:
    matchLabels:
      pod: a
  policyTypes:
  - Ingress
  - Egress

Discrepancy found:68 wrong, 9 ignored, 4 correct
Expected ingress:
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| SCTP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| SCTP/81 |     |     |     |     |     |     |     |     |     |
| TCP/80  |     |     |     |     |     |     |     |     |     |
| TCP/81  |     |     |     |     |     |     |     |     |     |
| UDP/80  |     |     |     |     |     |     |     |     |     |
| UDP/81  |     |     |     |     |     |     |     |     |     |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

Expected egress:
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| SCTP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| SCTP/81 |     |     |     |     |     |     |     |     |     |
| TCP/80  |     |     |     |     |     |     |     |     |     |
| TCP/81  |     |     |     |     |     |     |     |     |     |
| UDP/80  |     |     |     |     |     |     |     |     |     |
| UDP/81  |     |     |     |     |     |     |     |     |     |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

Expected combined:
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| SCTP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| SCTP/81 |     |     |     |     |     |     |     |     |     |
| TCP/80  |     |     |     |     |     |     |     |     |     |
| TCP/81  |     |     |     |     |     |     |     |     |     |
| UDP/80  |     |     |     |     |     |     |     |     |     |
| UDP/81  |     |     |     |     |     |     |     |     |     |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

kube results, try 0:
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| SCTP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| SCTP/81 |     |     |     |     |     |     |     |     |     |
| TCP/80  |     |     |     |     |     |     |     |     |     |
| TCP/81  |     |     |     |     |     |     |     |     |     |
| UDP/80  |     |     |     |     |     |     |     |     |     |
| UDP/81  |     |     |     |     |     |     |     |     |     |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

kube results, try 1:
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| SCTP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| SCTP/81 |     |     |     |     |     |     |     |     |     |
| TCP/80  |     |     |     |     |     |     |     |     |     |
| TCP/81  |     |     |     |     |     |     |     |     |     |
| UDP/80  |     |     |     |     |     |     |     |     |     |
| UDP/81  |     |     |     |     |     |     |     |     |     |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+


Actual vs expected (last round):
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+
|     | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a | .   | .   | .   | X   | X   | .   | X   | X   | .   |
| x/b | X   | X   | X   | X   | X   | X   | X   | X   | X   |
| x/c | X   | X   | X   | X   | X   | X   | X   | X   | X   |
| y/a | X   | X   | X   | X   | X   | X   | X   | X   | X   |
| y/b | X   | X   | X   | X   | X   | X   | X   | X   | X   |
| y/c | X   | X   | X   | X   | X   | X   | X   | X   | X   |
| z/a | X   | X   | X   | X   | X   | X   | X   | X   | X   |
| z/b | X   | X   | X   | X   | X   | X   | X   | X   | X   |
| z/c | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+



finished policy #10
starting test case #11
time="2021-04-29T02:07:51Z" level=info msg="cluster state reset"
time="2021-04-29T02:07:54Z" level=info msg="cluster state verified"
time="2021-04-29T02:07:54Z" level=info msg="step 1: waiting 5 seconds for perturbation to take effect"
time="2021-04-29T02:07:59Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-04-29T02:07:59Z" level=info msg="running kube probe on try 1"
time="2021-04-29T02:13:32Z" level=info msg="running kube probe on try 2"
evaluating test case: ingress: empty peers
step 1 on all available ports/protocols:
Policy explanation:
+---------+---------------+--------------+-------------------------------+-------------------------+
|  TYPE   |    TARGET     | SOURCE RULES |             PEER              |      PORT/PROTOCOL      |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Ingress | namespace: x  | x/base       | all pods, all ips             | port 80 on protocol TCP |
|         | Match labels: |              |                               |                         |
|         |   pod: a      |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
|         |               |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Egress  | namespace: x  | x/base       | all pods, all ips             | port 53 on protocol UDP |
|         | Match labels: |              |                               | port 53 on protocol TCP |
|         |   pod: a      |              |                               |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP |
|         |               |              |   ns In [y z]                 |                         |
|         |               |              | pods: Match expressions:      |                         |
|         |               |              |   pod In [a b]                |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: base
  namespace: x
spec:
  egress:
  - ports:
    - port: 80
      protocol: TCP
    to:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - "y"
          - z
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - a
          - b
  - ports:
    - port: 53
      protocol: UDP
    - port: 53
      protocol: TCP
  ingress:
  - ports:
    - port: 80
      protocol: TCP
  podSelector:
    matchLabels:
      pod: a
  policyTypes:
  - Ingress
  - Egress

Discrepancy found:68 wrong, 9 ignored, 4 correct
Expected ingress:
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| SCTP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| SCTP/81 |     |     |     |     |     |     |     |     |     |
| TCP/80  |     |     |     |     |     |     |     |     |     |
| TCP/81  |     |     |     |     |     |     |     |     |     |
| UDP/80  |     |     |     |     |     |     |     |     |     |
| UDP/81  |     |     |     |     |     |     |     |     |     |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

Expected egress:
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| SCTP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| SCTP/81 |     |     |     |     |     |     |     |     |     |
| TCP/80  |     |     |     |     |     |     |     |     |     |
| TCP/81  |     |     |     |     |     |     |     |     |     |
| UDP/80  |     |     |     |     |     |     |     |     |     |
| UDP/81  |     |     |     |     |     |     |     |     |     |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

Expected combined:
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| SCTP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| SCTP/81 |     |     |     |     |     |     |     |     |     |
| TCP/80  |     |     |     |     |     |     |     |     |     |
| TCP/81  |     |     |     |     |     |     |     |     |     |
| UDP/80  |     |     |     |     |     |     |     |     |     |
| UDP/81  |     |     |     |     |     |     |     |     |     |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

kube results, try 0:
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| SCTP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| SCTP/81 |     |     |     |     |     |     |     |     |     |
| TCP/80  |     |     |     |     |     |     |     |     |     |
| TCP/81  |     |     |     |     |     |     |     |     |     |
| UDP/80  |     |     |     |     |     |     |     |     |     |
| UDP/81  |     |     |     |     |     |     |     |     |     |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

kube results, try 1:
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| SCTP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| SCTP/81 |     |     |     |     |     |     |     |     |     |
| TCP/80  |     |     |     |     |     |     |     |     |     |
| TCP/81  |     |     |     |     |     |     |     |     |     |
| UDP/80  |     |     |     |     |     |     |     |     |     |
| UDP/81  |     |     |     |     |     |     |     |     |     |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+


Actual vs expected (last round):
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+
|     | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a | .   | .   | .   | X   | X   | .   | X   | X   | .   |
| x/b | X   | X   | X   | X   | X   | X   | X   | X   | X   |
| x/c | X   | X   | X   | X   | X   | X   | X   | X   | X   |
| y/a | X   | X   | X   | X   | X   | X   | X   | X   | X   |
| y/b | X   | X   | X   | X   | X   | X   | X   | X   | X   |
| y/c | X   | X   | X   | X   | X   | X   | X   | X   | X   |
| z/a | X   | X   | X   | X   | X   | X   | X   | X   | X   |
| z/b | X   | X   | X   | X   | X   | X   | X   | X   | X   |
| z/c | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+



finished policy #11
starting test case #12
time="2021-04-29T02:19:08Z" level=info msg="cluster state reset"
time="2021-04-29T02:19:11Z" level=info msg="cluster state verified"
time="2021-04-29T02:19:11Z" level=info msg="step 1: waiting 5 seconds for perturbation to take effect"
time="2021-04-29T02:19:16Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-04-29T02:19:16Z" level=info msg="running kube probe on try 1"
time="2021-04-29T02:24:49Z" level=info msg="running kube probe on try 2"
evaluating test case: egress: empty peers
step 1 on all available ports/protocols:
Policy explanation:
+---------+---------------+--------------+-------------------------------+-------------------------+
|  TYPE   |    TARGET     | SOURCE RULES |             PEER              |      PORT/PROTOCOL      |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Ingress | namespace: x  | x/base       | namespace: Match expressions: | port 80 on protocol TCP |
|         | Match labels: |              |   ns In [x y]                 |                         |
|         |   pod: a      |              | pods: Match expressions:      |                         |
|         |               |              |   pod In [b c]                |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
|         |               |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Egress  | namespace: x  | x/base       | all pods, all ips             | port 53 on protocol TCP |
|         | Match labels: |              |                               | port 53 on protocol TCP |
|         |   pod: a      |              |                               | port 53 on protocol UDP |
|         |               |              |                               | port 80 on protocol TCP |
+---------+---------------+--------------+-------------------------------+-------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: base
  namespace: x
spec:
  egress:
  - ports:
    - port: 80
      protocol: TCP
  - ports:
    - port: 53
      protocol: UDP
    - port: 53
      protocol: TCP
  ingress:
  - from:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - x
          - "y"
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - b
          - c
    ports:
    - port: 80
      protocol: TCP
  podSelector:
    matchLabels:
      pod: a
  policyTypes:
  - Ingress
  - Egress

Discrepancy found:68 wrong, 9 ignored, 4 correct
Expected ingress:
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| SCTP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| SCTP/81 |     |     |     |     |     |     |     |     |     |
| TCP/80  |     |     |     |     |     |     |     |     |     |
| TCP/81  |     |     |     |     |     |     |     |     |     |
| UDP/80  |     |     |     |     |     |     |     |     |     |
| UDP/81  |     |     |     |     |     |     |     |     |     |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

Expected egress:
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| SCTP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| SCTP/81 |     |     |     |     |     |     |     |     |     |
| TCP/80  |     |     |     |     |     |     |     |     |     |
| TCP/81  |     |     |     |     |     |     |     |     |     |
| UDP/80  |     |     |     |     |     |     |     |     |     |
| UDP/81  |     |     |     |     |     |     |     |     |     |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

Expected combined:
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| SCTP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| SCTP/81 |     |     |     |     |     |     |     |     |     |
| TCP/80  |     |     |     |     |     |     |     |     |     |
| TCP/81  |     |     |     |     |     |     |     |     |     |
| UDP/80  |     |     |     |     |     |     |     |     |     |
| UDP/81  |     |     |     |     |     |     |     |     |     |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

kube results, try 0:
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| SCTP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| SCTP/81 |     |     |     |     |     |     |     |     |     |
| TCP/80  |     |     |     |     |     |     |     |     |     |
| TCP/81  |     |     |     |     |     |     |     |     |     |
| UDP/80  |     |     |     |     |     |     |     |     |     |
| UDP/81  |     |     |     |     |     |     |     |     |     |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

kube results, try 1:
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| SCTP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| SCTP/81 |     |     |     |     |     |     |     |     |     |
| TCP/80  |     |     |     |     |     |     |     |     |     |
| TCP/81  |     |     |     |     |     |     |     |     |     |
| UDP/80  |     |     |     |     |     |     |     |     |     |
| UDP/81  |     |     |     |     |     |     |     |     |     |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+


Actual vs expected (last round):
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+
|     | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a | .   | X   | X   | X   | X   | X   | X   | X   | X   |
| x/b | X   | X   | X   | X   | X   | X   | X   | X   | X   |
| x/c | X   | X   | X   | X   | X   | X   | X   | X   | X   |
| y/a | .   | X   | X   | X   | X   | X   | X   | X   | X   |
| y/b | X   | X   | X   | X   | X   | X   | X   | X   | X   |
| y/c | X   | X   | X   | X   | X   | X   | X   | X   | X   |
| z/a | .   | X   | X   | X   | X   | X   | X   | X   | X   |
| z/b | .   | X   | X   | X   | X   | X   | X   | X   | X   |
| z/c | .   | X   | X   | X   | X   | X   | X   | X   | X   |
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+



finished policy #12
starting test case #13
time="2021-04-29T02:30:24Z" level=info msg="cluster state reset"
time="2021-04-29T02:30:27Z" level=info msg="cluster state verified"
time="2021-04-29T02:30:27Z" level=info msg="step 1: waiting 5 seconds for perturbation to take effect"
time="2021-04-29T02:30:32Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-04-29T02:30:32Z" level=info msg="running kube probe on try 1"
time="2021-04-29T02:36:05Z" level=info msg="running kube probe on try 2"
evaluating test case: empty pods + nil ns
step 1 on all available ports/protocols:
Policy explanation:
+---------+---------------+--------------+-------------------------------+-------------------------+
|  TYPE   |    TARGET     | SOURCE RULES |             PEER              |      PORT/PROTOCOL      |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Ingress | namespace: x  | x/base       | namespace: x                  | port 80 on protocol TCP |
|         | Match labels: |              | pods: all                     |                         |
|         |   pod: a      |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
|         |               |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Egress  | namespace: x  | x/base       | all pods, all ips             | port 53 on protocol UDP |
|         | Match labels: |              |                               | port 53 on protocol TCP |
|         |   pod: a      |              |                               |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP |
|         |               |              |   ns In [y z]                 |                         |
|         |               |              | pods: Match expressions:      |                         |
|         |               |              |   pod In [a b]                |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: base
  namespace: x
spec:
  egress:
  - ports:
    - port: 80
      protocol: TCP
    to:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - "y"
          - z
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - a
          - b
  - ports:
    - port: 53
      protocol: UDP
    - port: 53
      protocol: TCP
  ingress:
  - from:
    - podSelector: {}
    ports:
    - port: 80
      protocol: TCP
  podSelector:
    matchLabels:
      pod: a
  policyTypes:
  - Ingress
  - Egress

Discrepancy found:62 wrong, 9 ignored, 10 correct
Expected ingress:
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| SCTP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| SCTP/81 |     |     |     |     |     |     |     |     |     |
| TCP/80  |     |     |     |     |     |     |     |     |     |
| TCP/81  |     |     |     |     |     |     |     |     |     |
| UDP/80  |     |     |     |     |     |     |     |     |     |
| UDP/81  |     |     |     |     |     |     |     |     |     |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

Expected egress:
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| SCTP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| SCTP/81 |     |     |     |     |     |     |     |     |     |
| TCP/80  |     |     |     |     |     |     |     |     |     |
| TCP/81  |     |     |     |     |     |     |     |     |     |
| UDP/80  |     |     |     |     |     |     |     |     |     |
| UDP/81  |     |     |     |     |     |     |     |     |     |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

Expected combined:
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| SCTP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| SCTP/81 |     |     |     |     |     |     |     |     |     |
| TCP/80  |     |     |     |     |     |     |     |     |     |
| TCP/81  |     |     |     |     |     |     |     |     |     |
| UDP/80  |     |     |     |     |     |     |     |     |     |
| UDP/81  |     |     |     |     |     |     |     |     |     |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

kube results, try 0:
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| SCTP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| SCTP/81 |     |     |     |     |     |     |     |     |     |
| TCP/80  |     |     |     |     |     |     |     |     |     |
| TCP/81  |     |     |     |     |     |     |     |     |     |
| UDP/80  |     |     |     |     |     |     |     |     |     |
| UDP/81  |     |     |     |     |     |     |     |     |     |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

kube results, try 1:
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| SCTP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| SCTP/81 |     |     |     |     |     |     |     |     |     |
| TCP/80  |     |     |     |     |     |     |     |     |     |
| TCP/81  |     |     |     |     |     |     |     |     |     |
| UDP/80  |     |     |     |     |     |     |     |     |     |
| UDP/81  |     |     |     |     |     |     |     |     |     |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+


Actual vs expected (last round):
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+
|     | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a | .   | .   | .   | X   | X   | .   | X   | X   | .   |
| x/b | X   | X   | X   | X   | X   | X   | X   | X   | X   |
| x/c | X   | X   | X   | X   | X   | X   | X   | X   | X   |
| y/a | .   | X   | X   | X   | X   | X   | X   | X   | X   |
| y/b | .   | X   | X   | X   | X   | X   | X   | X   | X   |
| y/c | .   | X   | X   | X   | X   | X   | X   | X   | X   |
| z/a | .   | X   | X   | X   | X   | X   | X   | X   | X   |
| z/b | .   | X   | X   | X   | X   | X   | X   | X   | X   |
| z/c | .   | X   | X   | X   | X   | X   | X   | X   | X   |
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+



finished policy #13
starting test case #14
time="2021-04-29T02:41:42Z" level=info msg="cluster state reset"
time="2021-04-29T02:41:45Z" level=info msg="cluster state verified"
time="2021-04-29T02:41:45Z" level=info msg="step 1: waiting 5 seconds for perturbation to take effect"
time="2021-04-29T02:41:50Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-04-29T02:41:50Z" level=info msg="running kube probe on try 1"
time="2021-04-29T02:47:22Z" level=info msg="running kube probe on try 2"
evaluating test case: pods by label + nil ns
step 1 on all available ports/protocols:
Policy explanation:
+---------+---------------+--------------+-------------------------------+-------------------------+
|  TYPE   |    TARGET     | SOURCE RULES |             PEER              |      PORT/PROTOCOL      |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Ingress | namespace: x  | x/base       | namespace: x                  | port 80 on protocol TCP |
|         | Match labels: |              | pods: Match labels:           |                         |
|         |   pod: a      |              |   pod: c                      |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
|         |               |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Egress  | namespace: x  | x/base       | all pods, all ips             | port 53 on protocol UDP |
|         | Match labels: |              |                               | port 53 on protocol TCP |
|         |   pod: a      |              |                               |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP |
|         |               |              |   ns In [y z]                 |                         |
|         |               |              | pods: Match expressions:      |                         |
|         |               |              |   pod In [a b]                |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: base
  namespace: x
spec:
  egress:
  - ports:
    - port: 80
      protocol: TCP
    to:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - "y"
          - z
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - a
          - b
  - ports:
    - port: 53
      protocol: UDP
    - port: 53
      protocol: TCP
  ingress:
  - from:
    - podSelector:
        matchLabels:
          pod: c
    ports:
    - port: 80
      protocol: TCP
  podSelector:
    matchLabels:
      pod: a
  policyTypes:
  - Ingress
  - Egress

Discrepancy found:61 wrong, 9 ignored, 11 correct
Expected ingress:
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| SCTP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| SCTP/81 |     |     |     |     |     |     |     |     |     |
| TCP/80  |     |     |     |     |     |     |     |     |     |
| TCP/81  |     |     |     |     |     |     |     |     |     |
| UDP/80  |     |     |     |     |     |     |     |     |     |
| UDP/81  |     |     |     |     |     |     |     |     |     |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

Expected egress:
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| SCTP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| SCTP/81 |     |     |     |     |     |     |     |     |     |
| TCP/80  |     |     |     |     |     |     |     |     |     |
| TCP/81  |     |     |     |     |     |     |     |     |     |
| UDP/80  |     |     |     |     |     |     |     |     |     |
| UDP/81  |     |     |     |     |     |     |     |     |     |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

Expected combined:
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| SCTP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| SCTP/81 |     |     |     |     |     |     |     |     |     |
| TCP/80  |     |     |     |     |     |     |     |     |     |
| TCP/81  |     |     |     |     |     |     |     |     |     |
| UDP/80  |     |     |     |     |     |     |     |     |     |
| UDP/81  |     |     |     |     |     |     |     |     |     |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

kube results, try 0:
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| SCTP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| SCTP/81 |     |     |     |     |     |     |     |     |     |
| TCP/80  |     |     |     |     |     |     |     |     |     |
| TCP/81  |     |     |     |     |     |     |     |     |     |
| UDP/80  |     |     |     |     |     |     |     |     |     |
| UDP/81  |     |     |     |     |     |     |     |     |     |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

kube results, try 1:
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| SCTP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| SCTP/81 |     |     |     |     |     |     |     |     |     |
| TCP/80  |     |     |     |     |     |     |     |     |     |
| TCP/81  |     |     |     |     |     |     |     |     |     |
| UDP/80  |     |     |     |     |     |     |     |     |     |
| UDP/81  |     |     |     |     |     |     |     |     |     |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+


Actual vs expected (last round):
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+
|     | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a | .   | .   | .   | X   | X   | .   | X   | X   | .   |
| x/b | .   | X   | X   | X   | X   | X   | X   | X   | X   |
| x/c | X   | X   | X   | X   | X   | X   | X   | X   | X   |
| y/a | .   | X   | X   | X   | X   | X   | X   | X   | X   |
| y/b | .   | X   | X   | X   | X   | X   | X   | X   | X   |
| y/c | .   | X   | X   | X   | X   | X   | X   | X   | X   |
| z/a | .   | X   | X   | X   | X   | X   | X   | X   | X   |
| z/b | .   | X   | X   | X   | X   | X   | X   | X   | X   |
| z/c | .   | X   | X   | X   | X   | X   | X   | X   | X   |
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+



finished policy #14
starting test case #15
time="2021-04-29T02:52:57Z" level=info msg="cluster state reset"
time="2021-04-29T02:53:00Z" level=info msg="cluster state verified"
time="2021-04-29T02:53:00Z" level=info msg="step 1: waiting 5 seconds for perturbation to take effect"
time="2021-04-29T02:53:05Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-04-29T02:53:05Z" level=info msg="running kube probe on try 1"
time="2021-04-29T02:58:40Z" level=info msg="running kube probe on try 2"
evaluating test case: nil pods + empty ns
step 1 on all available ports/protocols:
Policy explanation:
+---------+---------------+--------------+-------------------------------+-------------------------+
|  TYPE   |    TARGET     | SOURCE RULES |             PEER              |      PORT/PROTOCOL      |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Ingress | namespace: x  | x/base       | namespace: all                | port 80 on protocol TCP |
|         | Match labels: |              | pods: all                     |                         |
|         |   pod: a      |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
|         |               |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Egress  | namespace: x  | x/base       | all pods, all ips             | port 53 on protocol UDP |
|         | Match labels: |              |                               | port 53 on protocol TCP |
|         |   pod: a      |              |                               |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP |
|         |               |              |   ns In [y z]                 |                         |
|         |               |              | pods: Match expressions:      |                         |
|         |               |              |   pod In [a b]                |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: base
  namespace: x
spec:
  egress:
  - ports:
    - port: 80
      protocol: TCP
    to:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - "y"
          - z
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - a
          - b
  - ports:
    - port: 53
      protocol: UDP
    - port: 53
      protocol: TCP
  ingress:
  - from:
    - namespaceSelector: {}
    ports:
    - port: 80
      protocol: TCP
  podSelector:
    matchLabels:
      pod: a
  policyTypes:
  - Ingress
  - Egress

Discrepancy found:68 wrong, 9 ignored, 4 correct
Expected ingress:
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| SCTP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| SCTP/81 |     |     |     |     |     |     |     |     |     |
| TCP/80  |     |     |     |     |     |     |     |     |     |
| TCP/81  |     |     |     |     |     |     |     |     |     |
| UDP/80  |     |     |     |     |     |     |     |     |     |
| UDP/81  |     |     |     |     |     |     |     |     |     |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

Expected egress:
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| SCTP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| SCTP/81 |     |     |     |     |     |     |     |     |     |
| TCP/80  |     |     |     |     |     |     |     |     |     |
| TCP/81  |     |     |     |     |     |     |     |     |     |
| UDP/80  |     |     |     |     |     |     |     |     |     |
| UDP/81  |     |     |     |     |     |     |     |     |     |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

Expected combined:
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| SCTP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| SCTP/81 |     |     |     |     |     |     |     |     |     |
| TCP/80  |     |     |     |     |     |     |     |     |     |
| TCP/81  |     |     |     |     |     |     |     |     |     |
| UDP/80  |     |     |     |     |     |     |     |     |     |
| UDP/81  |     |     |     |     |     |     |     |     |     |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

kube results, try 0:
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| SCTP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| SCTP/81 |     |     |     |     |     |     |     |     |     |
| TCP/80  |     |     |     |     |     |     |     |     |     |
| TCP/81  |     |     |     |     |     |     |     |     |     |
| UDP/80  |     |     |     |     |     |     |     |     |     |
| UDP/81  |     |     |     |     |     |     |     |     |     |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b     | X   | X   | X   | X   | X   | X   | X   | X   | .   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

kube results, try 1:
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| SCTP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| SCTP/81 |     |     |     |     |     |     |     |     |     |
| TCP/80  |     |     |     |     |     |     |     |     |     |
| TCP/81  |     |     |     |     |     |     |     |     |     |
| UDP/80  |     |     |     |     |     |     |     |     |     |
| UDP/81  |     |     |     |     |     |     |     |     |     |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+


Actual vs expected (last round):
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+
|     | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a | .   | .   | .   | X   | X   | .   | X   | X   | .   |
| x/b | X   | X   | X   | X   | X   | X   | X   | X   | X   |
| x/c | X   | X   | X   | X   | X   | X   | X   | X   | X   |
| y/a | X   | X   | X   | X   | X   | X   | X   | X   | X   |
| y/b | X   | X   | X   | X   | X   | X   | X   | X   | X   |
| y/c | X   | X   | X   | X   | X   | X   | X   | X   | X   |
| z/a | X   | X   | X   | X   | X   | X   | X   | X   | X   |
| z/b | X   | X   | X   | X   | X   | X   | X   | X   | X   |
| z/c | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+



finished policy #15
starting test case #16
time="2021-04-29T03:04:16Z" level=info msg="cluster state reset"
time="2021-04-29T03:04:19Z" level=info msg="cluster state verified"
time="2021-04-29T03:04:19Z" level=info msg="step 1: waiting 5 seconds for perturbation to take effect"
time="2021-04-29T03:04:24Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-04-29T03:04:24Z" level=info msg="running kube probe on try 1"
time="2021-04-29T03:09:57Z" level=info msg="running kube probe on try 2"
evaluating test case: empty pods + empty ns
step 1 on all available ports/protocols:
Policy explanation:
+---------+---------------+--------------+-------------------------------+-------------------------+
|  TYPE   |    TARGET     | SOURCE RULES |             PEER              |      PORT/PROTOCOL      |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Ingress | namespace: x  | x/base       | namespace: all                | port 80 on protocol TCP |
|         | Match labels: |              | pods: all                     |                         |
|         |   pod: a      |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
|         |               |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Egress  | namespace: x  | x/base       | all pods, all ips             | port 53 on protocol UDP |
|         | Match labels: |              |                               | port 53 on protocol TCP |
|         |   pod: a      |              |                               |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP |
|         |               |              |   ns In [y z]                 |                         |
|         |               |              | pods: Match expressions:      |                         |
|         |               |              |   pod In [a b]                |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: base
  namespace: x
spec:
  egress:
  - ports:
    - port: 80
      protocol: TCP
    to:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - "y"
          - z
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - a
          - b
  - ports:
    - port: 53
      protocol: UDP
    - port: 53
      protocol: TCP
  ingress:
  - from:
    - namespaceSelector: {}
      podSelector: {}
    ports:
    - port: 80
      protocol: TCP
  podSelector:
    matchLabels:
      pod: a
  policyTypes:
  - Ingress
  - Egress

Discrepancy found:68 wrong, 9 ignored, 4 correct
Expected ingress:
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| SCTP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| SCTP/81 |     |     |     |     |     |     |     |     |     |
| TCP/80  |     |     |     |     |     |     |     |     |     |
| TCP/81  |     |     |     |     |     |     |     |     |     |
| UDP/80  |     |     |     |     |     |     |     |     |     |
| UDP/81  |     |     |     |     |     |     |     |     |     |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

Expected egress:
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| SCTP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| SCTP/81 |     |     |     |     |     |     |     |     |     |
| TCP/80  |     |     |     |     |     |     |     |     |     |
| TCP/81  |     |     |     |     |     |     |     |     |     |
| UDP/80  |     |     |     |     |     |     |     |     |     |
| UDP/81  |     |     |     |     |     |     |     |     |     |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

Expected combined:
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| SCTP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| SCTP/81 |     |     |     |     |     |     |     |     |     |
| TCP/80  |     |     |     |     |     |     |     |     |     |
| TCP/81  |     |     |     |     |     |     |     |     |     |
| UDP/80  |     |     |     |     |     |     |     |     |     |
| UDP/81  |     |     |     |     |     |     |     |     |     |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

kube results, try 0:
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| SCTP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| SCTP/81 |     |     |     |     |     |     |     |     |     |
| TCP/80  |     |     |     |     |     |     |     |     |     |
| TCP/81  |     |     |     |     |     |     |     |     |     |
| UDP/80  |     |     |     |     |     |     |     |     |     |
| UDP/81  |     |     |     |     |     |     |     |     |     |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

kube results, try 1:
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| SCTP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| SCTP/81 |     |     |     |     |     |     |     |     |     |
| TCP/80  |     |     |     |     |     |     |     |     |     |
| TCP/81  |     |     |     |     |     |     |     |     |     |
| UDP/80  |     |     |     |     |     |     |     |     |     |
| UDP/81  |     |     |     |     |     |     |     |     |     |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+


Actual vs expected (last round):
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+
|     | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a | .   | .   | .   | X   | X   | .   | X   | X   | .   |
| x/b | X   | X   | X   | X   | X   | X   | X   | X   | X   |
| x/c | X   | X   | X   | X   | X   | X   | X   | X   | X   |
| y/a | X   | X   | X   | X   | X   | X   | X   | X   | X   |
| y/b | X   | X   | X   | X   | X   | X   | X   | X   | X   |
| y/c | X   | X   | X   | X   | X   | X   | X   | X   | X   |
| z/a | X   | X   | X   | X   | X   | X   | X   | X   | X   |
| z/b | X   | X   | X   | X   | X   | X   | X   | X   | X   |
| z/c | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+



finished policy #16
starting test case #17
time="2021-04-29T03:15:34Z" level=info msg="cluster state reset"
time="2021-04-29T03:15:37Z" level=info msg="cluster state verified"
time="2021-04-29T03:15:37Z" level=info msg="step 1: waiting 5 seconds for perturbation to take effect"
time="2021-04-29T03:15:42Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-04-29T03:15:42Z" level=info msg="running kube probe on try 1"
time="2021-04-29T03:21:15Z" level=info msg="running kube probe on try 2"
evaluating test case: pods by label + empty ns
step 1 on all available ports/protocols:
Policy explanation:
+---------+---------------+--------------+-------------------------------+-------------------------+
|  TYPE   |    TARGET     | SOURCE RULES |             PEER              |      PORT/PROTOCOL      |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Ingress | namespace: x  | x/base       | namespace: all                | port 80 on protocol TCP |
|         | Match labels: |              | pods: Match labels:           |                         |
|         |   pod: a      |              |   pod: c                      |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
|         |               |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Egress  | namespace: x  | x/base       | all pods, all ips             | port 53 on protocol UDP |
|         | Match labels: |              |                               | port 53 on protocol TCP |
|         |   pod: a      |              |                               |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP |
|         |               |              |   ns In [y z]                 |                         |
|         |               |              | pods: Match expressions:      |                         |
|         |               |              |   pod In [a b]                |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: base
  namespace: x
spec:
  egress:
  - ports:
    - port: 80
      protocol: TCP
    to:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - "y"
          - z
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - a
          - b
  - ports:
    - port: 53
      protocol: UDP
    - port: 53
      protocol: TCP
  ingress:
  - from:
    - namespaceSelector: {}
      podSelector:
        matchLabels:
          pod: c
    ports:
    - port: 80
      protocol: TCP
  podSelector:
    matchLabels:
      pod: a
  policyTypes:
  - Ingress
  - Egress

Discrepancy found:63 wrong, 9 ignored, 9 correct
Expected ingress:
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| SCTP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| SCTP/81 |     |     |     |     |     |     |     |     |     |
| TCP/80  |     |     |     |     |     |     |     |     |     |
| TCP/81  |     |     |     |     |     |     |     |     |     |
| UDP/80  |     |     |     |     |     |     |     |     |     |
| UDP/81  |     |     |     |     |     |     |     |     |     |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

Expected egress:
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| SCTP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| SCTP/81 |     |     |     |     |     |     |     |     |     |
| TCP/80  |     |     |     |     |     |     |     |     |     |
| TCP/81  |     |     |     |     |     |     |     |     |     |
| UDP/80  |     |     |     |     |     |     |     |     |     |
| UDP/81  |     |     |     |     |     |     |     |     |     |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

Expected combined:
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| SCTP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| SCTP/81 |     |     |     |     |     |     |     |     |     |
| TCP/80  |     |     |     |     |     |     |     |     |     |
| TCP/81  |     |     |     |     |     |     |     |     |     |
| UDP/80  |     |     |     |     |     |     |     |     |     |
| UDP/81  |     |     |     |     |     |     |     |     |     |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

kube results, try 0:
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| SCTP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| SCTP/81 |     |     |     |     |     |     |     |     |     |
| TCP/80  |     |     |     |     |     |     |     |     |     |
| TCP/81  |     |     |     |     |     |     |     |     |     |
| UDP/80  |     |     |     |     |     |     |     |     |     |
| UDP/81  |     |     |     |     |     |     |     |     |     |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

kube results, try 1:
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| SCTP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| SCTP/81 |     |     |     |     |     |     |     |     |     |
| TCP/80  |     |     |     |     |     |     |     |     |     |
| TCP/81  |     |     |     |     |     |     |     |     |     |
| UDP/80  |     |     |     |     |     |     |     |     |     |
| UDP/81  |     |     |     |     |     |     |     |     |     |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+


Actual vs expected (last round):
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+
|     | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a | .   | .   | .   | X   | X   | .   | X   | X   | .   |
| x/b | .   | X   | X   | X   | X   | X   | X   | X   | X   |
| x/c | X   | X   | X   | X   | X   | X   | X   | X   | X   |
| y/a | .   | X   | X   | X   | X   | X   | X   | X   | X   |
| y/b | .   | X   | X   | X   | X   | X   | X   | X   | X   |
| y/c | X   | X   | X   | X   | X   | X   | X   | X   | X   |
| z/a | .   | X   | X   | X   | X   | X   | X   | X   | X   |
| z/b | .   | X   | X   | X   | X   | X   | X   | X   | X   |
| z/c | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+



finished policy #17
starting test case #18
time="2021-04-29T03:26:51Z" level=info msg="cluster state reset"
time="2021-04-29T03:26:54Z" level=info msg="cluster state verified"
time="2021-04-29T03:26:54Z" level=info msg="step 1: waiting 5 seconds for perturbation to take effect"
time="2021-04-29T03:26:59Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-04-29T03:26:59Z" level=info msg="running kube probe on try 1"
time="2021-04-29T03:32:31Z" level=info msg="running kube probe on try 2"
evaluating test case: nil pods + ns by label
step 1 on all available ports/protocols:
Policy explanation:
+---------+---------------+--------------+-------------------------------+-------------------------+
|  TYPE   |    TARGET     | SOURCE RULES |             PEER              |      PORT/PROTOCOL      |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Ingress | namespace: x  | x/base       | namespace: Match labels:      | port 80 on protocol TCP |
|         | Match labels: |              |   ns: x                       |                         |
|         |   pod: a      |              | pods: all                     |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
|         |               |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Egress  | namespace: x  | x/base       | all pods, all ips             | port 53 on protocol UDP |
|         | Match labels: |              |                               | port 53 on protocol TCP |
|         |   pod: a      |              |                               |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP |
|         |               |              |   ns In [y z]                 |                         |
|         |               |              | pods: Match expressions:      |                         |
|         |               |              |   pod In [a b]                |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: base
  namespace: x
spec:
  egress:
  - ports:
    - port: 80
      protocol: TCP
    to:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - "y"
          - z
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - a
          - b
  - ports:
    - port: 53
      protocol: UDP
    - port: 53
      protocol: TCP
  ingress:
  - from:
    - namespaceSelector:
        matchLabels:
          ns: x
    ports:
    - port: 80
      protocol: TCP
  podSelector:
    matchLabels:
      pod: a
  policyTypes:
  - Ingress
  - Egress

Discrepancy found:62 wrong, 9 ignored, 10 correct
Expected ingress:
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| SCTP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| SCTP/81 |     |     |     |     |     |     |     |     |     |
| TCP/80  |     |     |     |     |     |     |     |     |     |
| TCP/81  |     |     |     |     |     |     |     |     |     |
| UDP/80  |     |     |     |     |     |     |     |     |     |
| UDP/81  |     |     |     |     |     |     |     |     |     |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

Expected egress:
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| SCTP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| SCTP/81 |     |     |     |     |     |     |     |     |     |
| TCP/80  |     |     |     |     |     |     |     |     |     |
| TCP/81  |     |     |     |     |     |     |     |     |     |
| UDP/80  |     |     |     |     |     |     |     |     |     |
| UDP/81  |     |     |     |     |     |     |     |     |     |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

Expected combined:
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| SCTP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| SCTP/81 |     |     |     |     |     |     |     |     |     |
| TCP/80  |     |     |     |     |     |     |     |     |     |
| TCP/81  |     |     |     |     |     |     |     |     |     |
| UDP/80  |     |     |     |     |     |     |     |     |     |
| UDP/81  |     |     |     |     |     |     |     |     |     |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

kube results, try 0:
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| SCTP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| SCTP/81 |     |     |     |     |     |     |     |     |     |
| TCP/80  |     |     |     |     |     |     |     |     |     |
| TCP/81  |     |     |     |     |     |     |     |     |     |
| UDP/80  |     |     |     |     |     |     |     |     |     |
| UDP/81  |     |     |     |     |     |     |     |     |     |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

kube results, try 1:
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| SCTP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| SCTP/81 |     |     |     |     |     |     |     |     |     |
| TCP/80  |     |     |     |     |     |     |     |     |     |
| TCP/81  |     |     |     |     |     |     |     |     |     |
| UDP/80  |     |     |     |     |     |     |     |     |     |
| UDP/81  |     |     |     |     |     |     |     |     |     |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+


Actual vs expected (last round):
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+
|     | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a | .   | .   | .   | X   | X   | .   | X   | X   | .   |
| x/b | X   | X   | X   | X   | X   | X   | X   | X   | X   |
| x/c | X   | X   | X   | X   | X   | X   | X   | X   | X   |
| y/a | .   | X   | X   | X   | X   | X   | X   | X   | X   |
| y/b | .   | X   | X   | X   | X   | X   | X   | X   | X   |
| y/c | .   | X   | X   | X   | X   | X   | X   | X   | X   |
| z/a | .   | X   | X   | X   | X   | X   | X   | X   | X   |
| z/b | .   | X   | X   | X   | X   | X   | X   | X   | X   |
| z/c | .   | X   | X   | X   | X   | X   | X   | X   | X   |
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+



finished policy #18
starting test case #19
time="2021-04-29T03:38:07Z" level=info msg="cluster state reset"
time="2021-04-29T03:38:10Z" level=info msg="cluster state verified"
time="2021-04-29T03:38:10Z" level=info msg="step 1: waiting 5 seconds for perturbation to take effect"
time="2021-04-29T03:38:15Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-04-29T03:38:15Z" level=info msg="running kube probe on try 1"
time="2021-04-29T03:43:48Z" level=info msg="running kube probe on try 2"
evaluating test case: empty pods + ns by label
step 1 on all available ports/protocols:
Policy explanation:
+---------+---------------+--------------+-------------------------------+-------------------------+
|  TYPE   |    TARGET     | SOURCE RULES |             PEER              |      PORT/PROTOCOL      |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Ingress | namespace: x  | x/base       | namespace: Match labels:      | port 80 on protocol TCP |
|         | Match labels: |              |   ns: x                       |                         |
|         |   pod: a      |              | pods: all                     |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
|         |               |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Egress  | namespace: x  | x/base       | all pods, all ips             | port 53 on protocol UDP |
|         | Match labels: |              |                               | port 53 on protocol TCP |
|         |   pod: a      |              |                               |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP |
|         |               |              |   ns In [y z]                 |                         |
|         |               |              | pods: Match expressions:      |                         |
|         |               |              |   pod In [a b]                |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: base
  namespace: x
spec:
  egress:
  - ports:
    - port: 80
      protocol: TCP
    to:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - "y"
          - z
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - a
          - b
  - ports:
    - port: 53
      protocol: UDP
    - port: 53
      protocol: TCP
  ingress:
  - from:
    - namespaceSelector:
        matchLabels:
          ns: x
      podSelector: {}
    ports:
    - port: 80
      protocol: TCP
  podSelector:
    matchLabels:
      pod: a
  policyTypes:
  - Ingress
  - Egress

Discrepancy found:62 wrong, 9 ignored, 10 correct
Expected ingress:
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| SCTP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| SCTP/81 |     |     |     |     |     |     |     |     |     |
| TCP/80  |     |     |     |     |     |     |     |     |     |
| TCP/81  |     |     |     |     |     |     |     |     |     |
| UDP/80  |     |     |     |     |     |     |     |     |     |
| UDP/81  |     |     |     |     |     |     |     |     |     |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

Expected egress:
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| SCTP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| SCTP/81 |     |     |     |     |     |     |     |     |     |
| TCP/80  |     |     |     |     |     |     |     |     |     |
| TCP/81  |     |     |     |     |     |     |     |     |     |
| UDP/80  |     |     |     |     |     |     |     |     |     |
| UDP/81  |     |     |     |     |     |     |     |     |     |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

Expected combined:
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| SCTP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| SCTP/81 |     |     |     |     |     |     |     |     |     |
| TCP/80  |     |     |     |     |     |     |     |     |     |
| TCP/81  |     |     |     |     |     |     |     |     |     |
| UDP/80  |     |     |     |     |     |     |     |     |     |
| UDP/81  |     |     |     |     |     |     |     |     |     |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

kube results, try 0:
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| SCTP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| SCTP/81 |     |     |     |     |     |     |     |     |     |
| TCP/80  |     |     |     |     |     |     |     |     |     |
| TCP/81  |     |     |     |     |     |     |     |     |     |
| UDP/80  |     |     |     |     |     |     |     |     |     |
| UDP/81  |     |     |     |     |     |     |     |     |     |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

kube results, try 1:
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| SCTP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| SCTP/81 |     |     |     |     |     |     |     |     |     |
| TCP/80  |     |     |     |     |     |     |     |     |     |
| TCP/81  |     |     |     |     |     |     |     |     |     |
| UDP/80  |     |     |     |     |     |     |     |     |     |
| UDP/81  |     |     |     |     |     |     |     |     |     |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+


Actual vs expected (last round):
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+
|     | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a | .   | .   | .   | X   | X   | .   | X   | X   | .   |
| x/b | X   | X   | X   | X   | X   | X   | X   | X   | X   |
| x/c | X   | X   | X   | X   | X   | X   | X   | X   | X   |
| y/a | .   | X   | X   | X   | X   | X   | X   | X   | X   |
| y/b | .   | X   | X   | X   | X   | X   | X   | X   | X   |
| y/c | .   | X   | X   | X   | X   | X   | X   | X   | X   |
| z/a | .   | X   | X   | X   | X   | X   | X   | X   | X   |
| z/b | .   | X   | X   | X   | X   | X   | X   | X   | X   |
| z/c | .   | X   | X   | X   | X   | X   | X   | X   | X   |
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+



finished policy #19
starting test case #20
time="2021-04-29T03:49:23Z" level=info msg="cluster state reset"
time="2021-04-29T03:49:26Z" level=info msg="cluster state verified"
time="2021-04-29T03:49:26Z" level=info msg="step 1: waiting 5 seconds for perturbation to take effect"
time="2021-04-29T03:49:31Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-04-29T03:49:31Z" level=info msg="running kube probe on try 1"
time="2021-04-29T03:55:05Z" level=info msg="running kube probe on try 2"
evaluating test case: pods by label + ns by label
step 1 on all available ports/protocols:
Policy explanation:
+---------+---------------+--------------+-------------------------------+-------------------------+
|  TYPE   |    TARGET     | SOURCE RULES |             PEER              |      PORT/PROTOCOL      |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Ingress | namespace: x  | x/base       | namespace: Match labels:      | port 80 on protocol TCP |
|         | Match labels: |              |   ns: x                       |                         |
|         |   pod: a      |              | pods: Match labels:           |                         |
|         |               |              |   pod: c                      |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
|         |               |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Egress  | namespace: x  | x/base       | all pods, all ips             | port 53 on protocol UDP |
|         | Match labels: |              |                               | port 53 on protocol TCP |
|         |   pod: a      |              |                               |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP |
|         |               |              |   ns In [y z]                 |                         |
|         |               |              | pods: Match expressions:      |                         |
|         |               |              |   pod In [a b]                |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: base
  namespace: x
spec:
  egress:
  - ports:
    - port: 80
      protocol: TCP
    to:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - "y"
          - z
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - a
          - b
  - ports:
    - port: 53
      protocol: UDP
    - port: 53
      protocol: TCP
  ingress:
  - from:
    - namespaceSelector:
        matchLabels:
          ns: x
      podSelector:
        matchLabels:
          pod: c
    ports:
    - port: 80
      protocol: TCP
  podSelector:
    matchLabels:
      pod: a
  policyTypes:
  - Ingress
  - Egress

Discrepancy found:61 wrong, 9 ignored, 11 correct
Expected ingress:
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| SCTP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| SCTP/81 |     |     |     |     |     |     |     |     |     |
| TCP/80  |     |     |     |     |     |     |     |     |     |
| TCP/81  |     |     |     |     |     |     |     |     |     |
| UDP/80  |     |     |     |     |     |     |     |     |     |
| UDP/81  |     |     |     |     |     |     |     |     |     |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

Expected egress:
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| SCTP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| SCTP/81 |     |     |     |     |     |     |     |     |     |
| TCP/80  |     |     |     |     |     |     |     |     |     |
| TCP/81  |     |     |     |     |     |     |     |     |     |
| UDP/80  |     |     |     |     |     |     |     |     |     |
| UDP/81  |     |     |     |     |     |     |     |     |     |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

Expected combined:
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| SCTP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| SCTP/81 |     |     |     |     |     |     |     |     |     |
| TCP/80  |     |     |     |     |     |     |     |     |     |
| TCP/81  |     |     |     |     |     |     |     |     |     |
| UDP/80  |     |     |     |     |     |     |     |     |     |
| UDP/81  |     |     |     |     |     |     |     |     |     |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

kube results, try 0:
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| SCTP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| SCTP/81 |     |     |     |     |     |     |     |     |     |
| TCP/80  |     |     |     |     |     |     |     |     |     |
| TCP/81  |     |     |     |     |     |     |     |     |     |
| UDP/80  |     |     |     |     |     |     |     |     |     |
| UDP/81  |     |     |     |     |     |     |     |     |     |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

kube results, try 1:
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| SCTP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| SCTP/81 |     |     |     |     |     |     |     |     |     |
| TCP/80  |     |     |     |     |     |     |     |     |     |
| TCP/81  |     |     |     |     |     |     |     |     |     |
| UDP/80  |     |     |     |     |     |     |     |     |     |
| UDP/81  |     |     |     |     |     |     |     |     |     |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+


Actual vs expected (last round):
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+
|     | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a | .   | .   | .   | X   | X   | .   | X   | X   | .   |
| x/b | .   | X   | X   | X   | X   | X   | X   | X   | X   |
| x/c | X   | X   | X   | X   | X   | X   | X   | X   | X   |
| y/a | .   | X   | X   | X   | X   | X   | X   | X   | X   |
| y/b | .   | X   | X   | X   | X   | X   | X   | X   | X   |
| y/c | .   | X   | X   | X   | X   | X   | X   | X   | X   |
| z/a | .   | X   | X   | X   | X   | X   | X   | X   | X   |
| z/b | .   | X   | X   | X   | X   | X   | X   | X   | X   |
| z/c | .   | X   | X   | X   | X   | X   | X   | X   | X   |
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+



finished policy #20
starting test case #21
time="2021-04-29T04:00:40Z" level=info msg="cluster state reset"
time="2021-04-29T04:00:43Z" level=info msg="cluster state verified"
time="2021-04-29T04:00:43Z" level=info msg="step 1: waiting 5 seconds for perturbation to take effect"
time="2021-04-29T04:00:48Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-04-29T04:00:48Z" level=info msg="running kube probe on try 1"
time="2021-04-29T04:06:20Z" level=info msg="running kube probe on try 2"
evaluating test case: simple ipblock
step 1 on all available ports/protocols:
Policy explanation:
+---------+---------------+--------------+-------------------------------+-------------------------+
|  TYPE   |    TARGET     | SOURCE RULES |             PEER              |      PORT/PROTOCOL      |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Ingress | namespace: x  | x/base       | 10.10.1.0/24                  | port 80 on protocol TCP |
|         | Match labels: |              | except []                     |                         |
|         |   pod: a      |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
|         |               |              |                               |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+
| Egress  | namespace: x  | x/base       | all pods, all ips             | port 53 on protocol UDP |
|         | Match labels: |              |                               | port 53 on protocol TCP |
|         |   pod: a      |              |                               |                         |
+         +               +              +-------------------------------+-------------------------+
|         |               |              | namespace: Match expressions: | port 80 on protocol TCP |
|         |               |              |   ns In [y z]                 |                         |
|         |               |              | pods: Match expressions:      |                         |
|         |               |              |   pod In [a b]                |                         |
+---------+---------------+--------------+-------------------------------+-------------------------+



Results for network policies:
Network policy:

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  creationTimestamp: null
  name: base
  namespace: x
spec:
  egress:
  - ports:
    - port: 80
      protocol: TCP
    to:
    - namespaceSelector:
        matchExpressions:
        - key: ns
          operator: In
          values:
          - "y"
          - z
      podSelector:
        matchExpressions:
        - key: pod
          operator: In
          values:
          - a
          - b
  - ports:
    - port: 53
      protocol: UDP
    - port: 53
      protocol: TCP
  ingress:
  - from:
    - ipBlock:
        cidr: 10.10.1.0/24
    ports:
    - port: 80
      protocol: TCP
  podSelector:
    matchLabels:
      pod: a
  policyTypes:
  - Ingress
  - Egress

Discrepancy found:64 wrong, 9 ignored, 8 correct
Expected ingress:
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| SCTP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| SCTP/81 |     |     |     |     |     |     |     |     |     |
| TCP/80  |     |     |     |     |     |     |     |     |     |
| TCP/81  |     |     |     |     |     |     |     |     |     |
| UDP/80  |     |     |     |     |     |     |     |     |     |
| UDP/81  |     |     |     |     |     |     |     |     |     |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

Expected egress:
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| SCTP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| SCTP/81 |     |     |     |     |     |     |     |     |     |
| TCP/80  |     |     |     |     |     |     |     |     |     |
| TCP/81  |     |     |     |     |     |     |     |     |     |
| UDP/80  |     |     |     |     |     |     |     |     |     |
| UDP/81  |     |     |     |     |     |     |     |     |     |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c     | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

Expected combined:
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| SCTP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| SCTP/81 |     |     |     |     |     |     |     |     |     |
| TCP/80  |     |     |     |     |     |     |     |     |     |
| TCP/81  |     |     |     |     |     |     |     |     |     |
| UDP/80  |     |     |     |     |     |     |     |     |     |
| UDP/81  |     |     |     |     |     |     |     |     |     |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | .   | .   | X   | .   | .   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c     | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | .   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
|         | X   | .   | .   | .   | .   | .   | .   | .   | .   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

kube results, try 0:
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| SCTP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| SCTP/81 |     |     |     |     |     |     |     |     |     |
| TCP/80  |     |     |     |     |     |     |     |     |     |
| TCP/81  |     |     |     |     |     |     |     |     |     |
| UDP/80  |     |     |     |     |     |     |     |     |     |
| UDP/81  |     |     |     |     |     |     |     |     |     |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+

kube results, try 1:
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| SCTP/80 | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
| SCTP/81 |     |     |     |     |     |     |     |     |     |
| TCP/80  |     |     |     |     |     |     |     |     |     |
| TCP/81  |     |     |     |     |     |     |     |     |     |
| UDP/80  |     |     |     |     |     |     |     |     |     |
| UDP/81  |     |     |     |     |     |     |     |     |     |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/b     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/c     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/b     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| y/c     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/a     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/b     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| z/c     | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
|         | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+---------+-----+-----+-----+-----+-----+-----+-----+-----+-----+


Actual vs expected (last round):
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+
|     | X/A | X/B | X/C | Y/A | Y/B | Y/C | Z/A | Z/B | Z/C |
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+
| x/a | .   | .   | .   | X   | X   | .   | X   | X   | .   |
| x/b | .   | X   | X   | X   | X   | X   | X   | X   | X   |
| x/c | X   | X   | X   | X   | X   | X   | X   | X   | X   |
| y/a | .   | X   | X   | X   | X   | X   | X   | X   | X   |
| y/b | X   | X   | X   | X   | X   | X   | X   | X   | X   |
| y/c | .   | X   | X   | X   | X   | X   | X   | X   | X   |
| z/a | X   | X   | X   | X   | X   | X   | X   | X   | X   |
| z/b | .   | X   | X   | X   | X   | X   | X   | X   | X   |
| z/c | X   | X   | X   | X   | X   | X   | X   | X   | X   |
+-----+-----+-----+-----+-----+-----+-----+-----+-----+-----+



finished policy #21
starting test case #22
time="2021-04-29T04:11:57Z" level=info msg="cluster state reset"
time="2021-04-29T04:12:00Z" level=info msg="cluster state verified"
time="2021-04-29T04:12:00Z" level=info msg="step 1: waiting 5 seconds for perturbation to take effect"
time="2021-04-29T04:12:05Z" level=info msg="running probe &{AllAvailable:true PortProtocol:<nil> Mode:service-name}"
time="2021-04-29T04:12:05Z" level=info msg="running kube probe on try 1"
