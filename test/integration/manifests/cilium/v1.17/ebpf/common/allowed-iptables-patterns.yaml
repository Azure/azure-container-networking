apiVersion: v1
data:
  filter: |
    ^.*--comment.*kubernetes load balancer firewall
    ^.*--comment.*kubernetes health check service ports
    ^.*--comment.*kubernetes externally visible service portals
    ^.*--comment.*kubernetes forwarding rules
    ^.*--comment.*kubernetes forwarding conntrack rule
    ^.*--comment.*kubernetes service portals
    ^.*--comment.*kubernetes externally-visible service portals

    -A INPUT -j KUBE-FIREWALL
    -A FORWARD -d 168.63.129.16/32 -p tcp -m tcp --dport 32526 -j DROP
    -A FORWARD -d 168.63.129.16/32 -p tcp -m tcp --dport 80 -j DROP
    -A OUTPUT -j KUBE-FIREWALL
    -A KUBE-FIREWALL ! -s 127.0.0.0/8 -d 127.0.0.0/8 -m comment --comment "block incoming localnet connections" -m conntrack ! --ctstate RELATED,ESTABLISHED,DNAT -j DROP
    -A KUBE-FORWARD -m conntrack --ctstate INVALID -j DROP
    -A KUBE-POSTROUTING -m mark ! --mark 0x4000/0x4000 -j RETURN
  global: |
    ^-N .*
    ^-P .*
    ^.*--comment.*cilium:
    ^.*--comment.*cilium-feeder:
    ^.*--comment.*AKS managed: added by AgentBaker
  mangle: |
    -A FORWARD -d 168.63.129.16/32 -p tcp -m tcp --dport 80 -j DROP
    -A FORWARD -d 168.63.129.16/32 -p tcp -m tcp --dport 32526 -j DROP
  nat: |
    ^.*--comment.*metrics-server
    ^.*--comment.*kube-dns
    ^.*--comment.*gatekeeper-webhook-service
    ^.*--comment.*azure-policy-webhook-service
    ^.*--comment.*kubernetes:https cluster IP
    ^.*--comment.*kubernetes forwarding rules
    ^.*--comment.*kubernetes service traffic requiring SNAT
    ^.*--comment.*kubernetes postrouting rules
    ^.*--set-xmark 0x4000
    ^.*--comment.*kubernetes service portals
    ^.*--comment.*kubernetes service nodeports
    ^.*--comment.*kubernetes:https
    ^.*--comment.*ip-masq-agent
    ^.*0x4000/0x4000
    -A POSTROUTING -j SWIFT
    -A SWIFT -s
    -A POSTROUTING -j SWIFT-POSTROUTING
    -A SWIFT-POSTROUTING -s
  raw: ""
  security: |
    -A OUTPUT -d 168.63.129.16/32 -p tcp -m tcp --dport 53 -j ACCEPT
    -A OUTPUT -d 168.63.129.16/32 -p tcp -m owner --uid-owner 0 -j ACCEPT
    -A OUTPUT -d 168.63.129.16/32 -p tcp -m conntrack --ctstate INVALID,NEW -j DROP
kind: ConfigMap
metadata:
  annotations:
    meta.helm.sh/release-name: cilium
    meta.helm.sh/release-namespace: kube-system
  labels:
    app.kubernetes.io/actually-managed-by: Eno
    app.kubernetes.io/managed-by: Helm
  name: allowed-iptables-patterns
  namespace: kube-system
