# Source images
export GO_IMG					?= mcr.microsoft.com/oss/go/microsoft/golang:1.24-azurelinux3.0
export MARINER_CORE_IMG			?= mcr.microsoft.com/azurelinux/base/core:3.0
export MARINER_DISTROLESS_IMG	?= mcr.microsoft.com/azurelinux/distroless/minimal:3.0
export WIN_HPC_IMG				?= mcr.microsoft.com/oss/kubernetes/windows-host-process-containers-base-image:v1.0.0


# Pinned SHA images
export GO_PIN					?= $(shell skopeo inspect docker://${GO_IMG} --format "{{.Name}}@{{.Digest}}")
export MARINER_CORE_PIN			?= $(shell skopeo inspect docker://${MARINER_CORE_IMG} --format "{{.Name}}@{{.Digest}}")
export MARINER_DISTROLESS_PIN 	?= $(shell skopeo inspect docker://${MARINER_DISTROLESS_IMG} --format "{{.Name}}@{{.Digest}}")
export WIN_HPC_PIN				?= $(shell skopeo inspect --override-os windows docker://${WIN_HPC_IMG} --format "{{.Name}}@{{.Digest}}")

export RENDER_MSG	?= "!! AUTOGENERATED - DO NOT EDIT !!"
export SRC 			?= ${PATH}/Dockerfile.tmpl
export DEST			?= ${PATH}/Dockerfile

export PIPE_PATH	?= .pipelines/build/dockerfiles
export SRC_PIPE 	?= ${PIPE_PATH}/${PATH}.Dockerfile.tmpl
export DEST_PIPE 	?= ${PIPE_PATH}/${PATH}.Dockerfile

print:
	@echo ${GO_PIN}
	@echo ${MARINER_CORE_PIN}
	@echo ${MARINER_DISTROLESS_PIN}
	@echo ${WIN_HPC_PIN}

render:
	${GOPATH}/bin/renderkit -f ${SRC} --ds env:// > ${DEST}
	${GOPATH}/bin/renderkit -f ${SRC_PIPE} --ds env:// > ${DEST_PIPE}
