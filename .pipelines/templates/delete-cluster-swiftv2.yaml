parameters:
  name: ""
  clusterName: ""
  region: ""

steps:
  - task: AzureCLI@2
    inputs:
      azureSubscription: ${{ parameters.svcConn }}
      scriptLocation: "inlineScript"
      scriptType: "bash"
      addSpnToEnvironment: true
      inlineScript: |
        echo "Deleting cluster"
        source ./.pipelines/multitenancy/scripts/utils.sh
        export_envVars ${{ parameters.scenario }} 

        make -C ./hack/aks azcfg AZCLI=az REGION=${{ parameters.region }}
        make -C ./hack/aks set-kubeconf AZCLI=az CLUSTER=${{ parameters.clusterName }} GROUP=$RG
        make -C ./hack/aks down AZCLI=az REGION=$LOCATION SUB=$SUB CLUSTER=${{ parameters.clusterName }} GROUP=$RG
        echo "Cluster and resources down"
    name: delete
    displayName: Delete - ${{ parameters.name }}