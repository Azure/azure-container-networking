parameters:
- name: tool
  type: string
  values:
  - buildah
  - skopeo
  - podman
  - lsof

- name: steps
  type: stepList
  default: []
  

steps:
- ${{ each step in parameters.steps }}:
  - bash: |
      set -e
      CMD=$(printf '%s %s' "$PKG_MGR_INSTALL_CMD" "$PKG")
      "$CMD"
      CMD=$(printf '%s %s' "$PKG_CLI" "$PKG_VERSION_ARG")
  
      [[ $HAS_VERSION -eq [T|t]rue ]] && \
        echo >&2 "[command]"$CMD"" && \
        "$CMD"
    displayName: 'Installing Package (${{ parameters.tool }})'
    env:
      PKG: '${{ steps.templateContext.pkgName }}'
      HAS_VERSION: '${{ steps.templateContext.hasVersion }}'
      PKG_VERSION_ARG: '${{ steps.templateContext.versionCmd }}'
      ${{ if step.templateContext.os, 'mariner') }}:
        PKG_MGR_INSTALL_CMD: 'sudo tdnf install -y'
      ${{ elseif step.templateContext.os, 'ubuntu') }}:
        PKG_MGR_INSTALL_CMD: 'sudo apt-get install -y'
