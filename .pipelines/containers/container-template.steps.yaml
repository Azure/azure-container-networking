parameters:
  arch: ""
  name: ""
  os: ""

steps:
- task: AzureCLI@2
  displayName: "Image Build"
  retryCountOnTaskFailure: 3
  inputs:
    azureSubscription: $(ACR_ARM_SERVICE_CONNECTION)
    addSpnToEnvironment: True
    scriptLocation: "inlineScript"
    scriptType: "bash"
    inlineScript: |
      set -e
      make "$MAKE_CMD"
  env:
    OS: ${{ parameters.os }}
    ARCH: ${{ parameters.arch }}
    MAKE_CMD: ${{ parameters.name }}-image
    ${{ if eq(parameters.os, 'windows') }}:
      BUILDX_ACTION: '--push'
