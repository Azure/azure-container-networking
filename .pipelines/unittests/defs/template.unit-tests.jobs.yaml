#################################
#### UNIT TEST BASE TEMPLATE ####
#################################
# Description:
#
# The base (abstract) class template for defining a unit test group. When you 
# would like to create a new group of unittests, create a new file under defs 
# folder and implement the basic tasks needed to execute the unit tests.
# You can add variables or other items you would like each of the unit tests to
# have access to here.
# 
# If you would like to depend on any of the jobs generated by this template,
# the job name is updated to match the format 'test_${{ groupName }}' by this
# template.

parameters:

#### Public Parameters ####

# The job list associated with the concrete class. The steps from this 
# parameter will be included in the generated pipeline output.
- name: testJobs
  type: jobList
  default: []


jobs:
- ${{ each job in parameters.testJobs }}:

  - job: test_${{ job.job }}
    displayName: "Unit Tests (${{ job.displayName }})"
    pool: ${{ job.pool }}

    variables:
      ACN_DIR: azure-container-networking
      ACN_PATH: $(Build.SourcesDirectory)/$(ACN_DIR)
      #ob_artifactSuffix: ${{ job.templateContext.Suffix }} # this is needed to not collide published artifact containers for matrix usage
      ob_outputDirectory: $(Build.ArtifactStagingDirectory)
      ob_git_checkout: true
      #
      ## Add Variables Defined in Sub Class
      ${{ if job.variables }}:
        ${{ each var in job.variables }}:
          ${{ each pair in var }}:
            ${{ if pair.key }}:
              ${{ pair.key }}: ${{ pair.value }}

    steps: ${{ job.steps }}
