pr:
  branches:
    include:
      - master
      - release/*
  paths:
    exclude:
      - ".devcontainer"
      - ".hooks"
      - ".vscode"
      - ".github"
      - docs

trigger:
  branches:
    include:
      - gh-readonly-queue/master/*
  tags:
    include:
      - "*"

variables:
  ADO_COMPLIANT_BUILD_PROJECT_URI: $(VAR_PROJECT_URI)
  ADO_COMPLIANT_BUILD_ORG: $(VAR_BUILD_ORG)
  ADO_AUTH_METHOD: $(VAR_AUTH_METHOD)
  ADO_AUTHORIZATION: $(VAR_AUTH)
  ADO_COMPLIANT_PIPELINE_ID: $(VAR_PIPELINE_ID)

jobs:
- job: trigger
  steps:
  - task: TriggerBuild@4
    displayName: Trigger Compliant Build
    timeoutInMinutes: 120
    inputs:
      definitionIsInCurrentTeamProject: false
      tfsServer: $(ADO_COMPLIANT_BUILD_PROJECT_URI)
      teamProject: $(ADO_COMPLIANT_BUILD_ORG)
      buildDefinition: $(ADO_COMPLIANT_PIPELINE_ID)
      queueBuildForUserThatTriggeredBuild: true
      useSameBranch: true
      authenticationMethod: $(ADO_AUTH_METHOD)
      password: $(ADO_AUTHORIZATION)
      storeInEnvironmentVariable: true
      waitForQueuedBuildsToFinish: true
      treatPartiallySucceededBuildAsSuccessful: false
      downloadBuildArtifacts: false
      failTaskIfBuildsNotSuccessful: true
      waitForQueuedBuildsToFinishRefreshTime: 120
      ignoreSslCertificateErrors: false
