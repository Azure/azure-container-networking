parameters:
# List of supported tools in this task.
- name: tool
  type: string
  values:
  - buildah
  - skopeo
  - podman
  - lsof

- name: os
  type: string
  values:
  - windows
  - mariner
  - ubuntu

- name: pkgName
  type: string

- name: pkgCli
  type: string
  default: ''

- name: hasVersion
  type: boolean
  default: false

- name: versionCmd
  type: string
  default: '--version'


steps:
- bash: |
    set -e
    CMD=$(printf '%s %s' "$PKG_MGR_INSTALL_CMD" "$PKG")
    $CMD
    CMD=$(printf '%s %s' "$PKG_CLI" "$PKG_VERSION_ARG")

    [[ $HAS_VERSION =~ [T|t]rue ]] && \
      echo >&2 "[command]"$CMD"" && \
      $CMD || echo >&2 "Skipping version print."
  displayName: 'Installing Package (${{ parameters.tool }})'
  env:
    PKG: '${{ parameters.pkgName }}'
    HAS_VERSION: '${{ parameters.hasVersion }}'
    PKG_VERSION_ARG: '${{ parameters.versionCmd }}'
    PKG_CLI: '${{ parameters.pkgCli }}'
    ${{ if eq(parameters.os, 'mariner') }}:
      PKG_MGR_INSTALL_CMD: 'sudo tdnf install -y'
    ${{ elseif eq(parameters.os, 'ubuntu') }}:
      PKG_MGR_INSTALL_CMD: 'sudo apt-get install -y'
