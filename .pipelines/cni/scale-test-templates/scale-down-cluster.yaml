parameters:
  clusterName: ""

steps:
  - task: AzureCLI@1
    inputs:
      azureSubscription: $(TEST_SUB_SERVICE_CONNECTION)
      scriptLocation: "inlineScript"
      scriptType: "bash"
      addSpnToEnvironment: true
      inlineScript: |
        echo "Tests completed. Scale back down to 5 nodes. Scale down at increments of 100"
        echo "Scaling to 900 nodes"
        az aks nodepool scale --name nodepool1 --cluster-name cilium-scale --resource-group cilium-scale --node-count 900
    name: "ScaleDown900"
    displayName: "Scale down to 900 Nodes"
  
  - script: |
      echo "Scaling to 800 nodes"
      az aks nodepool scale --name nodepool1 --cluster-name cilium-scale --resource-group cilium-scale --node-count 800
    name: "ScaleDown800"
    displayName: "Scale down to 800 Nodes"

  - script: |
      echo "Scaling to 700 nodes"
      az aks nodepool scale --name nodepool1 --cluster-name cilium-scale --resource-group cilium-scale --node-count 700
    name: "ScaleDown700"
    displayName: "Scale down to 700 Nodes"

  - script: |
      echo "Scaling to 600 nodes"
      az aks nodepool scale --name nodepool1 --cluster-name cilium-scale --resource-group cilium-scale --node-count 600
    name: "ScaleDown800"
    displayName: "Scale down to 600 Nodes"

  - script: |
      echo "Scaling to 500 nodes"
      az aks nodepool scale --name nodepool1 --cluster-name cilium-scale --resource-group cilium-scale --node-count 500
    name: "ScaleDown500"
    displayName: "Scale down to 500 Nodes"

  - script: |
      echo "Scaling to 400 nodes"
      az aks nodepool scale --name nodepool1 --cluster-name cilium-scale --resource-group cilium-scale --node-count 400
    name: "ScaleDown400"
    displayName: "Scale down to 400 Nodes"

  - script: |
      echo "Scaling to 300 nodes"
      az aks nodepool scale --name nodepool1 --cluster-name cilium-scale --resource-group cilium-scale --node-count 300
    name: "ScaleDown300"
    displayName: "Scale down to 300 Nodes"

  - script: |
      echo "Scaling to 200 nodes"
      az aks nodepool scale --name nodepool1 --cluster-name cilium-scale --resource-group cilium-scale --node-count 200
    name: "ScaleDown200"
    displayName: "Scale down to 200 Nodes"

  - script: |
      echo "Scaling to 100 nodes"
      az aks nodepool scale --name nodepool1 --cluster-name cilium-scale --resource-group cilium-scale --node-count 100
    name: "ScaleDown800"
    displayName: "Scale down to 100 Nodes"

  - script: |
      echo "Scaling to 5 nodes"
      az aks nodepool scale --name nodepool1 --cluster-name cilium-scale --resource-group cilium-scale --node-count 5
    name: "ScaleDown5"
    displayName: "Scale down to 5 Nodes"
