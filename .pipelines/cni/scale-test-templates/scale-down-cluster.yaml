parameters:
  clusterName: ""
  nodeCount1: ""
  nodeCount2: ""
  nodeCount3: ""

steps:
  - task: AzureCLI@1
    inputs:
      azureSubscription: $(TEST_SUB_SERVICE_CONNECTION)
      scriptLocation: "inlineScript"
      scriptType: "bash"
      addSpnToEnvironment: true
      inlineScript: |
        echo "Tests completed. Scale back down to 5 nodes. Scale down at increments of 100"
        echo "Scaling to ${{ parameters.nodeCount1 }} nodes"
        az aks nodepool scale --name nodepool1 --cluster-name ${{ parameters.clusterName }}  --resource-group ${{ parameters.clusterName }}  --node-count ${{ parameters.nodeCount1 }}
    name: "ScaleDown1"
    displayName: "Scale down to ${{ parameters.nodeCount1 }} Nodes"
  
  - task: AzureCLI@1
    inputs:
      azureSubscription: $(TEST_SUB_SERVICE_CONNECTION)
      scriptLocation: "inlineScript"
      scriptType: "bash"
      addSpnToEnvironment: true
      inlineScript: |
        echo "Scaling to ${{ parameters.nodeCount2 }} nodes"
        az aks nodepool scale --name nodepool1 --cluster-name ${{ parameters.clusterName }}  --resource-group ${{ parameters.clusterName }}  --node-count ${{ parameters.nodeCount2 }}
    name: "ScaleDown2"
    displayName: "Scale down to ${{ parameters.nodeCount2 }} Nodes"

  # - task: AzureCLI@1
  #   inputs:
  #     azureSubscription: $(TEST_SUB_SERVICE_CONNECTION)
  #     scriptLocation: "inlineScript"
  #     scriptType: "bash"
  #     addSpnToEnvironment: true
  #     inlineScript: |
  #       echo "Scaling to ${{ parameters.nodeCount3 }} nodes"
  #       az aks nodepool scale --name nodepool1 --cluster-name ${{ parameters.clusterName }}  --resource-group ${{ parameters.clusterName }}  --node-count ${{ parameters.nodeCount3 }}
  #   name: "ScaleDown3"
  #   displayName: "Scale down to ${{ parameters.nodeCount3 }} Nodes"

  # - task: AzureCLI@1
  #   inputs:
  #     azureSubscription: $(TEST_SUB_SERVICE_CONNECTION)
  #     scriptLocation: "inlineScript"
  #     scriptType: "bash"
  #     addSpnToEnvironment: true
  #     inlineScript: |
  #       echo "Scaling to 600 nodes"
  #       az aks nodepool scale --name nodepool1 --cluster-name cilium-scale --resource-group cilium-scale --node-count 600
  #   name: "ScaleDown600"
  #   displayName: "Scale down to 600 Nodes"

  # - task: AzureCLI@1
  #   inputs:
  #     azureSubscription: $(TEST_SUB_SERVICE_CONNECTION)
  #     scriptLocation: "inlineScript"
  #     scriptType: "bash"
  #     addSpnToEnvironment: true
  #     inlineScript: |
  #       echo "Scaling to 500 nodes"
  #       az aks nodepool scale --name nodepool1 --cluster-name cilium-scale --resource-group cilium-scale --node-count 500
  #   name: "ScaleDown500"
  #   displayName: "Scale down to 500 Nodes"

  # - task: AzureCLI@1
  #   inputs:
  #     azureSubscription: $(TEST_SUB_SERVICE_CONNECTION)
  #     scriptLocation: "inlineScript"
  #     scriptType: "bash"
  #     addSpnToEnvironment: true
  #     inlineScript: |
  #       echo "Scaling to 400 nodes"
  #       az aks nodepool scale --name nodepool1 --cluster-name cilium-scale --resource-group cilium-scale --node-count 400
  #   name: "ScaleDown400"
  #   displayName: "Scale down to 400 Nodes"

  # - task: AzureCLI@1
  #   inputs:
  #     azureSubscription: $(TEST_SUB_SERVICE_CONNECTION)
  #     scriptLocation: "inlineScript"
  #     scriptType: "bash"
  #     addSpnToEnvironment: true
  #     inlineScript: |
  #       echo "Scaling to 300 nodes"
  #       az aks nodepool scale --name nodepool1 --cluster-name cilium-scale --resource-group cilium-scale --node-count 300
  #   name: "ScaleDown300"
  #   displayName: "Scale down to 300 Nodes"

  # - task: AzureCLI@1
  #   inputs:
  #     azureSubscription: $(TEST_SUB_SERVICE_CONNECTION)
  #     scriptLocation: "inlineScript"
  #     scriptType: "bash"
  #     addSpnToEnvironment: true
  #     inlineScript: |
  #       echo "Scaling to 200 nodes"
  #       az aks nodepool scale --name nodepool1 --cluster-name cilium-scale --resource-group cilium-scale --node-count 200
  #   name: "ScaleDown200"
  #   displayName: "Scale down to 200 Nodes"

  # - task: AzureCLI@1
  #   inputs:
  #     azureSubscription: $(TEST_SUB_SERVICE_CONNECTION)
  #     scriptLocation: "inlineScript"
  #     scriptType: "bash"
  #     addSpnToEnvironment: true
  #     inlineScript: |
  #       echo "Scaling to 100 nodes"
  #       az aks nodepool scale --name nodepool1 --cluster-name cilium-scale --resource-group cilium-scale --node-count 100
  #   name: "ScaleDown100"
  #   displayName: "Scale down to 100 Nodes"

  # - task: AzureCLI@1
  #   inputs:
  #     azureSubscription: $(TEST_SUB_SERVICE_CONNECTION)
  #     scriptLocation: "inlineScript"
  #     scriptType: "bash"
  #     addSpnToEnvironment: true
  #     inlineScript: |
  #       echo "Scaling to 5 nodes"
  #       az aks nodepool scale --name nodepool1 --cluster-name cilium-scale --resource-group cilium-scale --node-count 5
  #   name: "ScaleDown5"
  #   displayName: "Scale down to 5 Nodes"
