parameters:
  group: ""
  cluster: ""

steps:
  - task: AzureCLI@1
    inputs:
      azureSubscription: $(TEST_SUB_SERVICE_CONNECTION)
      scriptLocation: "inlineScript"
      scriptType: "bash"
      addSpnToEnvironment: true
      inlineScript: |
        set -ex
        az aks get-credentials -n ${{ parameters.cluster }} -g ${{ parameters.group }} --file $(KUBECONFIG)
        printenv KUBECONFIG
        make test-multitenancy
    name: "ConnectCluster"
    displayName: "Retrieve Kubeconf"
