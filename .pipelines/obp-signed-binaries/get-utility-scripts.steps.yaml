######################################################################################################
# Get Utility Scripts (Steps) Template
######################################################################################################
# Used for retrieving the pipeline utility script that simplifies some Azure DevOps pipeline functions.
# Adds a reference to the utility's executable into the current job.
#
# Outputs:
#   ACN_UTILS: The path to the utility script executable.
#     <scope: current job>
######################################################################################################
steps:
  - checkout: acn_master
    path: util-script-download
    fetchDepth: 1
    fetchTags: false
    condition: and(succeeded(), eq(variables.ACN_UTILS, ''))

  - bash: |
      set -e

      echo "##[group]Repo Directory"
      ls -la $(Agent.BuildDirectory)/util-script-download
      echo "##[endgroup]"

      mkdir -p $(dirname "$DESTINATION_PATH")
      cp "$SOURCE_PATH" "$DESTINATION_PATH"
      chmod +x "$DESTINATION_PATH"
      echo "##vso[task.setvariable variable=ACN_UTILS]$DESTINATION_PATH"
      
      echo "##[group]File Contents"
      cat "$DESTINATION_PATH"
      echo "##[endgroup]"
    displayName: Get Utility Script
    condition: and(succeeded(), eq(variables.ACN_UTILS, ''))
    env:
      SOURCE_PATH: $(Agent.BuildDirectory)/util-script-download/.pipelines/scripts/build-utils.sh
      DESTINATION_PATH: /home/vsts/.local/bin/build-utils.sh
