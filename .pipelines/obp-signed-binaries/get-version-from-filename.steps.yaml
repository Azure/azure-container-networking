parameters:
  - name: filename
    type: string

steps:
- bash: |
    [[ "$FILENAME" =~ (v[[:digit:]]+([.][[:digit:]]+)+)[.]('zip'|'tgz')$ ]] && VERSION="${BASH_REMATCH[1]}" || VERSION='nomatch'

    if [[ "$VERSION" == 'nomatch' ]]; then
      echo "No version match found in file ($FILENAME)."
      exit 1
    else
      echo "##vso[task.setvariable variable=version;isOutput=true;]$VERSION"
      echo "Setting version: $VERSION"
    fi
  name: get_version
  displayName: Prepare Version Variables
  env:
    FILENAME: ${{ parameters.filename }}
