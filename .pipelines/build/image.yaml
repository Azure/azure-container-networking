parameters:
- name: images
  type: jobList

jobs:
- ${{ each job_data in parameters.images }}:
  - template: inner-replicate.jobs.yaml
    parameters:
      topic:
        job: image_${{ job_data.job }}
        ${{ each prop in job_data }}:
          ${{ if ne(prop.key, 'job') }}:
            ${{ prop }}
  
      sub_topics:
      - ${{ if eq(job_data.templateContext.action, 'pkg') }}:
        - job: pkg
          steps:
          - ${{ job_data.steps }}
      - ${{ elseif eq(job_data.templateContext.action, 'build') }}:
        - job: build
          dependsOn:
          - pkg
          variables:

          steps:
          - ${{ job_data.steps }}
      - ${{ elseif eq(job_data.templateContext.action, 'manifest') }}:
        - job: manifest
          dependsOn:
          - build
          steps:
          - ${{ job_data.steps }}
      - ${{ else }}:
        - job:
          steps:
          - bash: |
              echo "template problem"
