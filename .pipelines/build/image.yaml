parameters:
- name: images
  type: jobList
  default:
  - job: acn
    templateContext:
      action: pkg
    steps:
    - bash: |
        echo "pkg test"
  - job: acn
    templateContext:
      action: build
    steps:
    - bash: |
        echo "build test"
  - job: acn
    templateContext:
      action: manifest
    steps:
    - bash: |
        echo "pkg test"
  - job: acn
    templateContext:
      action: sign
    steps:
    - bash: |
        echo "pkg test"

jobs:
- template: replicator.jobs.yaml
  parameters:
    topics:
    - ${{ each job_data in parameters.images }}:
      - job: image_${{ job_data.job }}
        pool:
          type: linux

    sub_topics:
    - ${{ if eq(job_data.templateContext.action, 'pkg') }}:
      - job: pkg
        steps:
        - ${{ job_data.steps }}
    - ${{ if eq(job_data.templateContext.action, 'build') }}:
      - job: build
        dependsOn:
        - pkg
        steps:
        - ${{ job_data.steps }}
    - ${{ if eq(job_data.templateContext.action, 'manifest') }}:
      - job: manifest
        dependsOn:
        - build
        steps:
        - ${{ job_data.steps }}
    - ${{ if eq(job_data.templateContext.action, 'sign') }}:
      - job: sign
        dependsOn:
        - build
        steps:
        - ${{ job_data.steps }}
